import{c as ee,j as e,r as I,g as te,ai as A,h as z,z as de,E as pe,I as P,H as L,J as ue,F as ie,i as se,k as _,T as c,l as H,p as S,a8 as xe,q as U,B as p,D as me,Y as he,u as fe,a as ge,f as je,G as ye,_ as be,$ as K,K as N,b as W,ah as Z,o as ve,Z as _e,R as we,U as Ce,x as Ie,e as Se}from"./index-Bn-mPDw0.js";import{u as De}from"./CategoryContext-B3ytQrhB.js";const ke=ee(e.jsx("path",{d:"M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m0 14H8V4h12zM4 6H2v14c0 1.1.9 2 2 2h14v-2H4zm12 6V9c0-.55-.45-1-1-1h-2v5h2c.55 0 1-.45 1-1m-2-3h1v3h-1zm4 2h1v-1h-1V9h1V8h-2v5h1zm-8 0h1c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1H9v5h1zm0-2h1v1h-1z"})),Te=ee(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m-2.5-3.5 7-4.5-7-4.5z"})),Q={title:"",lesson:"",image:[],video:[],document:[]},J=xe("input")({clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:1});function Re({open:k,handleClose:u,courseRecord:q,setCourseRecord:B,selectedSection:n}){const[E,F]=I.useState(!1),[O,$]=I.useState(Q);I.useEffect(()=>{if(n){const l=(a,x)=>a.map(o=>({name:o.split("/").pop(),preview:o,lastModified:Date.now(),type:x,url:o,createdAt:new Date().toISOString()})),v={title:n.title||"",lesson:n.lesson||"",image:n.image[0]?.type?n.image:l(n.image||[],"image/*"),video:n.video[0]?.type?n.video:l(n.video||[],"video/*"),document:n.document[0]?.type?n.document:l(n.document||[],"application/*")};$(v)}else $(Q)},[n]);const w=te({title:z().required("Section Title is required"),image:A().min(1,"At least one image is required").required("Image is required"),video:A().min(1,"At least one video is required").required("Video is required"),document:A().min(1,"At least one document is required").required("Document is required")}),R=async l=>{if(F(!0),n)B(v=>{const a=v.sections.map(x=>x._id===n._id?{...x,...l}:x);return{...v,sections:a}});else{const v=q?.sections?.length+1||1,a={...l,_id:v};B(x=>({...x,sections:[...x.sections,a]}))}F(!1),u()};return e.jsxs(de,{fullWidth:!0,open:k,sx:{borderRadius:"12px"},onClose:u,children:[e.jsxs(pe,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[n?"Update":"Add"," Section",e.jsx(P,{color:"inherit",sx:{border:"1px solid black"},onClick:u,children:e.jsx(L,{})})]}),e.jsx(ue,{dividers:!0,children:e.jsx(ie,{initialValues:O,enableReinitialize:!0,validationSchema:w,onSubmit:R,children:({errors:l,handleChange:v,values:a,handleBlur:x,touched:o,setFieldValue:C})=>e.jsxs(se,{style:{width:"100%",display:"flex",flexDirection:"column",gap:"1rem",marginTop:"0.5rem"},children:[e.jsxs(_,{fullWidth:!0,children:[e.jsx(c,{sx:{mx:.5,mb:.4},children:"Section Title"}),e.jsx(H,{name:"title",type:"text",placeholder:"Section Title",value:a.title,onChange:v,onBlur:x,error:o.title&&!!l.title,helperText:o.title&&l.title})]}),e.jsxs(_,{fullWidth:!0,children:[e.jsx(c,{sx:{mx:.5,mb:.4},children:"Text Lesson"}),e.jsx(H,{name:"lesson",type:"text",multiline:!0,rows:4,placeholder:"Text Lesson",value:a.lesson,onChange:v})]}),e.jsxs(_,{fullWidth:!0,children:[e.jsx(c,{sx:{mx:.5,mb:.4},children:"Image Upload"}),e.jsxs(S,{component:"label",role:void 0,variant:"outlined",tabIndex:-1,className:"upload-button",children:["Upload Image",e.jsx(J,{type:"file",name:"image",accept:"image/*",multiple:!0,onBlur:x,onChange:h=>{const j=Array.from(h.currentTarget.files||[]).map(m=>Object.assign(m,{preview:URL.createObjectURL(m)}));C("image",[...a.image||[],...j])}})]}),o.image&&!!l.image&&e.jsx(U,{error:!0,children:l.image}),a.image&&a.image.length>0&&e.jsx(p,{mt:2,display:"flex",flexWrap:"wrap",gap:2,children:a.image.map((h,g)=>e.jsxs(p,{display:"flex",alignItems:"center",gap:1,sx:{position:"relative",border:"1px solid #ccc",borderRadius:"8px",padding:"8px 12px",backgroundColor:"#f9f9f9",width:"146px"},children:[e.jsx(P,{sx:{position:"absolute",top:"-11px",right:"-11px",padding:"4px",color:"#fff",bgcolor:"black","&:hover":{bgcolor:"black"}},onClick:()=>{const j=a.image.filter((m,T)=>T!==g);C("image",j)},children:e.jsx(L,{fontSize:"small"})}),e.jsx("img",{src:h.preview||URL.createObjectURL(h.image),alt:"preview",style:{width:"100%",maxHeight:"180px",objectFit:"contain"}})]},g))})]}),e.jsxs(_,{fullWidth:!0,children:[e.jsx(c,{sx:{mx:.5,mb:.4},children:"Video Upload"}),e.jsxs(S,{component:"label",role:void 0,variant:"outlined",tabIndex:-1,className:"upload-button",children:["Upload Video",e.jsx(J,{type:"file",name:"video",accept:"video/*",onBlur:x,onChange:h=>{const j=Array.from(h.currentTarget.files||[]).map(m=>Object.assign(m,{preview:URL.createObjectURL(m)}));C("video",[...a.video||[],...j])},multiple:!0})]}),o.video&&!!l.video&&e.jsx(U,{error:!0,children:l.video}),a.video&&a.video.length>0&&e.jsx(p,{mt:2,display:"flex",flexWrap:"wrap",gap:2,children:a.video.map((h,g)=>e.jsxs(p,{display:"flex",alignItems:"center",gap:1,sx:{position:"relative",border:"1px solid #ccc",borderRadius:"8px",padding:"8px 12px",backgroundColor:"#f9f9f9"},children:[e.jsx(P,{sx:{position:"absolute",top:"-11px",right:"-11px",padding:"4px",color:"#fff",bgcolor:"black","&:hover":{bgcolor:"black"}},onClick:()=>{const j=a.video.filter((m,T)=>T!==g);C("video",j)},children:e.jsx(L,{fontSize:"small"})}),e.jsx(Te,{fontSize:"large"}),e.jsx(c,{variant:"body2",noWrap:!0,maxWidth:500,children:h.name})]},g))})]}),e.jsxs(_,{fullWidth:!0,children:[e.jsx(c,{sx:{mx:.5,mb:.4},children:"PDF / Document Upload"}),e.jsxs(S,{component:"label",role:void 0,variant:"outlined",tabIndex:-1,className:"upload-button",children:["Upload Document",e.jsx(J,{type:"file",name:"image",accept:"application/pdf, application/msword, application/vnd.openxmlformats-officedocument.wordprocessingml.document",onBlur:x,onChange:h=>{const j=Array.from(h.currentTarget.files||[]).map(m=>Object.assign(m,{preview:URL.createObjectURL(m)}));C("document",[...a.document||[],...j])},multiple:!0})]}),o.document&&!!l.document&&e.jsx(U,{error:!0,children:l.document}),a.document&&a.document.length>0&&e.jsx(p,{mt:2,display:"flex",flexWrap:"wrap",gap:2,children:a.document.map((h,g)=>e.jsxs(p,{display:"flex",alignItems:"center",gap:1,sx:{position:"relative",border:"1px solid #ccc",borderRadius:"8px",padding:"8px 12px",backgroundColor:"#f9f9f9"},children:[e.jsx(P,{sx:{position:"absolute",top:"-11px",right:"-11px",padding:"4px",color:"#fff",bgcolor:"black","&:hover":{bgcolor:"black"}},onClick:()=>{const j=a.document.filter((m,T)=>T!==g);C("document",j)},children:e.jsx(L,{fontSize:"small"})}),e.jsx(ke,{fontSize:"large"}),e.jsx(c,{variant:"body2",noWrap:!0,maxWidth:500,children:h.name})]},g))})]}),e.jsx(me,{sx:{margin:"0px -24px"}}),e.jsxs(p,{sx:{display:"flex",justifyContent:"end",gap:"10px",width:"100%"},children:[e.jsx(S,{type:"submit",variant:"contained",color:"primary",loading:E,sx:{backgroundColor:"black",width:"100px",borderRadius:"10px",padding:"10px",fontWeight:"500",fontSize:"18px"},children:n?"Update":"Add"}),e.jsx(S,{variant:"contained",color:"",sx:{backgroundColor:"white",width:"100px",borderRadius:"10px",padding:"10px",fontWeight:"500",fontSize:"18px"},onClick:()=>u(),children:"Cancel"})]})]})})})]})}const We={title:"",description:"",sections:[],category:"",status:"active",instructor_ids:"",participant_ids:[],image:null},ze=48,Ue=8,X={PaperProps:{style:{maxHeight:ze*4.5+Ue,width:250}}};function $e(){const{id:k}=he(),{user:u}=fe(),q=ge(),{categoryData:B,refetchCategories:n,instructors:E,refetchInstructors:F,participants:O,refetchParticipants:$}=De(),{showToast:w}=je(),R=Se(),[l,v]=I.useState(!1),[a,x]=I.useState(null),[o,C]=I.useState(We),[h,g]=I.useState([]),[j,m]=I.useState(!1),[T,V]=I.useState(null);console.log("Update Data",o);const Y=async i=>{try{const{data:s,status:y,error:r}=await R(`/api/categories/finduserbycategory/${i}`,"GET");y===200?g(s.data):w(r,"error")}catch{w("Failed to fetch course.","error")}},re=async()=>{try{const{data:i,status:s,error:y}=await R(`/api/course/${k}`,"GET");if(s===200){const r=i.course;r.category=r.category_id?._id,r.instructor_ids=r.instructor_ids||"",r.participant_ids=r.participant_ids?.map(d=>d._id)||[],r.image=r.course_image,r.status=r.status===!0?"active":"inactive",C(r),u?.user_type===1&&r.instructor_ids&&Y(r.instructor_ids)}else w(y,"error")}catch{w("Failed to fetch course.","error")}};I.useEffect(()=>{k?(u?.user_type===1?F():$(),re(),u?.user_type===2&&n()):(u?.user_type===1?F():$(),u?.user_type===2&&n())},[]);const M=u?.user_type===1?h:B,ae=i=>{V(i),m(!0)},ne=()=>{m(!1),V(null)},oe=i=>{const s=i[0];s&&(s.preview=URL.createObjectURL(s),x(s))},ce=te({title:z().required("Course Title required"),description:z().required("Description required"),instructor_ids:u?.user_type===1?z().required("Instructor required"):z(),participant_ids:u?.user_type===2?A().min(1,"At least one participant required"):A(),category:z().required("Category required")}),le=async i=>{const s=new FormData;s.append("title",i.title),s.append("description",i.description),s.append("category_id",i.category),s.append("status",i.status==="active"),u?.user_type===1?s.append("instructor_ids",i.instructor_ids):s.append("participant_ids",JSON.stringify(i.participant_ids)),a instanceof File&&s.append("course_image",a||null),(i.sections||[]).forEach((r,d)=>{s.append(`sections[${d}].title`,r.title),s.append(`sections[${d}].lesson`,r.lesson),r.image?.forEach((f,t)=>{f instanceof File&&s.append(`sections[${d}].image`,f)}),r.video?.forEach((f,t)=>{f instanceof File&&s.append(`sections[${d}].video`,f)}),r.document?.forEach((f,t)=>{f instanceof File&&s.append(`sections[${d}].document`,f)})}),v(!0);try{if(k){const{data:r,status:d,error:f}=await R(`/api/course/update/${k}`,"PUT",s,!0);d===200?(w(r.message,"success"),q("/admin/course")):w(f,"error")}else{const{data:r,status:d,error:f}=await R("/api/course/create","POST",s,!0);d===200?(w(r.message,"success"),q("/admin/course")):w(f,"error")}}catch{w("Failed to update course.","error")}finally{v(!1)}};return e.jsxs(p,{style:{padding:"1.25rem",height:"100%",overflowY:"auto"},children:[e.jsxs("div",{children:[e.jsxs(c,{variant:"subtitle1",fontSize:"1.5rem",fontWeight:500,children:[k?"Update":"Create"," Course"]}),e.jsx(c,{variant:"subtitle2",fontWeight:500,children:"Details about the course"})]}),e.jsx(ye,{container:!0,spacing:2,justifyContent:"center",my:2,children:e.jsx(ie,{initialValues:o,enableReinitialize:!0,validationSchema:ce,onSubmit:le,children:({errors:i,handleChange:s,values:y,handleBlur:r,touched:d,setFieldValue:f})=>e.jsxs(se,{style:{width:"100%",display:"flex",flexDirection:"column",gap:"1rem",marginTop:"0.5rem"},children:[e.jsxs(p,{sx:{display:"flex",gap:"2rem",width:"100%"},children:[e.jsxs(_,{fullWidth:!0,error:!!i.title,children:[e.jsx(c,{sx:{mx:.5,mb:.4},children:"Course Title"}),e.jsx(H,{id:"title",name:"title",type:"text",placeholder:"Course Title",value:y.title,onChange:s,onBlur:r,error:d.title&&!!i.title,helperText:d.title&&i.title})]}),e.jsxs(_,{fullWidth:!0,children:[e.jsx(c,{sx:{mx:.5,mb:.4},children:"Status"}),e.jsxs(be,{sx:{padding:"10px 0px",gap:"1rem"},children:[e.jsx(K,{checked:y.status==="active",onChange:s,value:"active",label:"Active",name:"status",size:"md"}),e.jsx(K,{checked:y.status==="inactive",onChange:s,value:"inactive",label:"Inactive",name:"status",size:"md"})]})]})]}),e.jsxs(p,{sx:{display:"flex",gap:"2rem",width:"100%"},children:[u?.user_type===1?e.jsxs(_,{fullWidth:!0,error:!!i.instructor_ids,children:[e.jsx(c,{sx:{mx:.5,mb:.4},children:"Instructors"}),e.jsxs(N,{displayEmpty:!0,id:"instructor_ids",name:"instructor_ids",MenuProps:X,value:y.instructor_ids||[],onChange:t=>{s(t);const b=t.target.value;b&&(Y(b),f("category",""))},onBlur:r,renderValue:t=>{if(!t||t.length===0)return e.jsx("span",{style:{color:"#aaa"},children:"Select Instructors"});const b=E.find(D=>D._id===t);return b?`${b.first_name} ${b.last_name}`:""},children:[e.jsx(W,{disabled:!0,value:"",children:e.jsx("em",{children:"Select Instructors"})}),E.map(t=>e.jsx(W,{value:t._id,children:e.jsx(Z,{primary:`${t.first_name} ${t.last_name}`})},t._id))]}),i.instructor_ids&&e.jsx(U,{children:i.instructor_ids})]}):e.jsxs(_,{fullWidth:!0,error:!!i.participant_ids,children:[e.jsx(c,{sx:{mx:.5,mb:.4},children:"Participants"}),e.jsxs(N,{multiple:!0,displayEmpty:!0,label:"",id:"participant_ids",name:"participant_ids",MenuProps:X,value:y.participant_ids||[],onChange:s,onBlur:r,renderValue:t=>!t||t.length===0?e.jsx("span",{style:{color:"#aaa"},children:"Select Participants"}):t.map(b=>{const D=O.find(G=>G._id===b);return D?`${D.first_name} ${D.last_name}`:""}).join(", "),children:[e.jsx(W,{value:"",disabled:!0,children:e.jsx("em",{children:"Select Participants"})}),O.map(t=>e.jsxs(W,{value:t._id,children:[e.jsx(ve,{color:"black",checked:y.participant_ids?.includes(t._id)}),e.jsx(Z,{primary:`${t.first_name} ${t.last_name}`})]},t._id))]}),i.participant_ids&&e.jsx(U,{children:i.participant_ids})]}),e.jsxs(_,{fullWidth:!0,error:!!i.category,children:[e.jsx(c,{sx:{mx:.5,mb:.4},children:"Category"}),e.jsxs(N,{id:"category",name:"category",value:y.category,onChange:s,onBlur:r,displayEmpty:!0,renderValue:t=>{const b=M.find(D=>D._id===t);return b?b.name:e.jsx("span",{style:{color:"#aaa"},children:"Select Category"})},children:[e.jsx(W,{disabled:!0,value:"",children:e.jsx("em",{children:"Select Category"})}),M.length>0&&M.map(t=>e.jsx(W,{value:t._id,children:t.name},t._id))]}),d.category&&!!i.category&&e.jsx(U,{children:i.category})]})]}),e.jsxs(p,{sx:{display:"flex",gap:"2rem",width:"100%"},children:[e.jsxs(_,{fullWidth:!0,error:!!i.description,children:[e.jsx(c,{sx:{mx:.5,mb:.4},children:"Description"}),e.jsx(H,{id:"description",type:"text",multiline:!0,rows:4,placeholder:"Description",value:y.description,onChange:s,onBlur:r,error:d.description&&!!i.description,helperText:d.description&&i.description})]}),e.jsxs(_,{fullWidth:!0,children:[e.jsx(c,{sx:{mx:.5,mb:.4},children:"Course Image"}),e.jsx(_e,{onDrop:oe,mode:"Drag",preview:!0,selectedFile:a?.preview||o.image,multiple:!0,accept:{"image/*":[],"video/*":[],"application/pdf":[]}})]})]}),e.jsxs(p,{children:[o?.sections.length>0&&e.jsx(c,{sx:{mx:.5,mb:.4},children:"Sections"}),o?.sections.length>0&&o?.sections.map((t,b)=>e.jsxs(p,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",my:1,p:2,backgroundColor:"#f9f9f9",border:"1px solid #ccc",borderRadius:"8px"},children:[e.jsx(p,{children:e.jsx(c,{variant:"h6",children:t.title})}),e.jsxs(p,{sx:{display:"flex",gap:"10px"},children:[e.jsx(S,{variant:"outlined",color:"primary",onClick:()=>ae(t),startIcon:e.jsx(we,{}),children:"Edit"}),e.jsx(S,{variant:"outlined",color:"error",startIcon:e.jsx(Ce,{}),onClick:()=>{const D=o?.sections.filter(G=>G!==t);C({...o,sections:D})},children:"Delete"})]})]},b))]}),e.jsx(p,{children:e.jsx(S,{variant:"contained",color:"primary",sx:{bgcolor:"black",borderRadius:"10px",padding:"5px 10px",fontWeight:"500",fontSize:"18px"},startIcon:e.jsx(Ie,{}),onClick:()=>{V(null),m(!0)},children:"Add Section"})}),e.jsxs(p,{sx:{display:"flex",justifyContent:"end",gap:"10px",width:"100%",my:2},children:[e.jsx(S,{loading:l,type:"submit",variant:"contained",color:"primary",sx:{backgroundColor:"black",width:"100px",borderRadius:"10px",padding:"10px",fontWeight:"500",fontSize:"18px"},children:k?"Update":"Save"}),e.jsx(S,{variant:"contained",color:"",sx:{backgroundColor:"white",width:"100px",borderRadius:"10px",padding:"10px",fontWeight:"500",fontSize:"18px"},onClick:()=>q("/admin/course"),children:"Cancel"})]})]})})}),e.jsx(Re,{open:j,courseRecord:o,setCourseRecord:C,handleClose:ne,selectedSection:T})]})}export{$e as default};
