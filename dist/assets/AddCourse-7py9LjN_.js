import{c as X,j as e,r as k,g as Z,ai as O,h as z,z as ce,E as le,I as $,H as B,J as de,F as ee,i as te,k as _,T as o,l as H,p as I,a8 as ie,q as P,B as c,D as pe,Y as xe,u as ue,a as me,f as he,G as ge,_ as fe,$ as J,K as G,b as W,ah as Y,o as je,R as ye,U as be,x as _e,e as ve}from"./index-CqBZos2q.js";import{u as we}from"./CategoryContext-B7HIPoAi.js";const Ce=X(e.jsx("path",{d:"M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m0 14H8V4h12zM4 6H2v14c0 1.1.9 2 2 2h14v-2H4zm12 6V9c0-.55-.45-1-1-1h-2v5h2c.55 0 1-.45 1-1m-2-3h1v3h-1zm4 2h1v-1h-1V9h1V8h-2v5h1zm-8 0h1c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1H9v5h1zm0-2h1v1h-1z"})),Ie=X(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m-2.5-3.5 7-4.5-7-4.5z"})),K={title:"",lesson:"",image:[],video:[],document:[]},N=ie("input")({clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:1});function Se({open:T,handleClose:m,courseRecord:U,setCourseRecord:E,selectedSection:n}){const[F,q]=k.useState(!1),[L,A]=k.useState(K);k.useEffect(()=>{if(n){const l=(s,d)=>s.map(w=>({name:w?.stored_name.split("/").pop(),preview:w?.stored_name,lastModified:Date.now(),type:d,url:w,createdAt:new Date().toISOString()})),y={title:n.title||"",lesson:n.lesson||"",image:n.image[0]?.type?n.image:l(n.image||[],"image/*"),video:n.video[0]?.type?n.video:l(n.video||[],"video/*"),document:n.document[0]?.type?n.document:l(n.document||[],"application/*")};A(y)}else A(K)},[n]);const v=Z({title:z().required("Section Title is required"),image:O().min(1,"At least one image is required").required("Image is required"),video:O().min(1,"At least one video is required").required("Video is required"),document:O().min(1,"At least one document is required").required("Document is required")}),R=async l=>{if(q(!0),n)E(y=>{const s=y.sections.map(d=>d._id===n._id?{...d,...l}:d);return console.log("prev:",y),{...y,sections:s}});else{const y=U?.sections?.length+1||1,s={...l,_id:y};E(d=>({...d,sections:[...d.sections,s]}))}q(!1),m()};return e.jsxs(ce,{fullWidth:!0,open:T,sx:{borderRadius:"12px"},onClose:m,children:[e.jsxs(le,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[n?"Update":"Add"," Section",e.jsx($,{color:"inherit",sx:{border:"1px solid black"},onClick:m,children:e.jsx(B,{})})]}),e.jsx(de,{dividers:!0,children:e.jsx(ee,{initialValues:L,enableReinitialize:!0,validationSchema:v,onSubmit:R,children:({errors:l,handleChange:y,values:s,handleBlur:d,touched:w,setFieldValue:S})=>e.jsxs(te,{style:{width:"100%",display:"flex",flexDirection:"column",gap:"1rem",marginTop:"0.5rem"},children:[e.jsxs(_,{fullWidth:!0,children:[e.jsx(o,{sx:{mx:.5,mb:.4},children:"Section Title"}),e.jsx(H,{name:"title",type:"text",placeholder:"Section Title",value:s.title,onChange:y,onBlur:d,error:w.title&&!!l.title,helperText:w.title&&l.title})]}),e.jsxs(_,{fullWidth:!0,children:[e.jsx(o,{sx:{mx:.5,mb:.4},children:"Text Lesson"}),e.jsx(H,{name:"lesson",type:"text",multiline:!0,rows:4,placeholder:"Text Lesson",value:s.lesson,onChange:y})]}),e.jsxs(_,{fullWidth:!0,children:[e.jsx(o,{sx:{mx:.5,mb:.4},children:"Image Upload"}),e.jsxs(I,{component:"label",role:void 0,variant:"outlined",tabIndex:-1,className:"upload-button",children:["Upload Image",e.jsx(N,{type:"file",name:"image",accept:"image/*",multiple:!0,onBlur:d,onChange:j=>{const b=Array.from(j.currentTarget.files||[]).map(g=>Object.assign(g,{preview:URL.createObjectURL(g)}));S("image",[...s.image||[],...b])}})]}),w.image&&!!l.image&&e.jsx(P,{error:!0,children:l.image}),s.image&&s.image.length>0&&e.jsx(c,{mt:2,display:"flex",flexWrap:"wrap",gap:2,children:s.image.map((j,h)=>e.jsxs(c,{display:"flex",alignItems:"center",gap:1,sx:{position:"relative",border:"1px solid #ccc",borderRadius:"8px",padding:"8px 12px",backgroundColor:"#f9f9f9",width:"146px"},children:[e.jsx($,{sx:{position:"absolute",top:"-11px",right:"-11px",padding:"4px",color:"#fff",bgcolor:"black","&:hover":{bgcolor:"black"}},onClick:()=>{const b=s.image.filter((g,D)=>D!==h);S("image",b)},children:e.jsx(B,{fontSize:"small"})}),e.jsx("img",{src:j.preview||URL.createObjectURL(j.image),alt:"preview",style:{width:"100%",maxHeight:"180px",objectFit:"contain"}})]},h))})]}),e.jsxs(_,{fullWidth:!0,children:[e.jsx(o,{sx:{mx:.5,mb:.4},children:"Video Upload"}),e.jsxs(I,{component:"label",role:void 0,variant:"outlined",tabIndex:-1,className:"upload-button",children:["Upload Video",e.jsx(N,{type:"file",name:"video",accept:"video/*",onBlur:d,onChange:j=>{const b=Array.from(j.currentTarget.files||[]).map(g=>Object.assign(g,{preview:URL.createObjectURL(g)}));S("video",[...s.video||[],...b])},multiple:!0})]}),w.video&&!!l.video&&e.jsx(P,{error:!0,children:l.video}),s.video&&s.video.length>0&&e.jsx(c,{mt:2,display:"flex",flexWrap:"wrap",gap:2,children:s.video.map((j,h)=>e.jsxs(c,{display:"flex",alignItems:"center",gap:1,sx:{position:"relative",border:"1px solid #ccc",borderRadius:"8px",padding:"8px 12px",backgroundColor:"#f9f9f9"},children:[e.jsx($,{sx:{position:"absolute",top:"-11px",right:"-11px",padding:"4px",color:"#fff",bgcolor:"black","&:hover":{bgcolor:"black"}},onClick:()=>{const b=s.video.filter((g,D)=>D!==h);S("video",b)},children:e.jsx(B,{fontSize:"small"})}),e.jsx(Ie,{fontSize:"large"}),e.jsx(o,{variant:"body2",noWrap:!0,maxWidth:500,children:j.name})]},h))})]}),e.jsxs(_,{fullWidth:!0,children:[e.jsx(o,{sx:{mx:.5,mb:.4},children:"PDF / Document Upload"}),e.jsxs(I,{component:"label",role:void 0,variant:"outlined",tabIndex:-1,className:"upload-button",children:["Upload Document",e.jsx(N,{type:"file",name:"image",accept:"application/pdf, application/msword, application/vnd.openxmlformats-officedocument.wordprocessingml.document",onBlur:d,onChange:j=>{const b=Array.from(j.currentTarget.files||[]).map(g=>Object.assign(g,{preview:URL.createObjectURL(g)}));S("document",[...s.document||[],...b])},multiple:!0})]}),w.document&&!!l.document&&e.jsx(P,{error:!0,children:l.document}),s.document&&s.document.length>0&&e.jsx(c,{mt:2,display:"flex",flexWrap:"wrap",gap:2,children:s.document.map((j,h)=>e.jsxs(c,{display:"flex",alignItems:"center",gap:1,sx:{position:"relative",border:"1px solid #ccc",borderRadius:"8px",padding:"8px 12px",backgroundColor:"#f9f9f9"},children:[e.jsx($,{sx:{position:"absolute",top:"-11px",right:"-11px",padding:"4px",color:"#fff",bgcolor:"black","&:hover":{bgcolor:"black"}},onClick:()=>{const b=s.document.filter((g,D)=>D!==h);S("document",b)},children:e.jsx(B,{fontSize:"small"})}),e.jsx(Ce,{fontSize:"large"}),e.jsx(o,{variant:"body2",noWrap:!0,maxWidth:500,children:j.name})]},h))})]}),e.jsx(pe,{sx:{margin:"0px -24px"}}),e.jsxs(c,{sx:{display:"flex",justifyContent:"end",gap:"10px",width:"100%"},children:[e.jsx(I,{type:"submit",variant:"contained",color:"primary",loading:F,sx:{backgroundColor:"black",width:"100px",borderRadius:"10px",padding:"10px",fontWeight:"500",fontSize:"18px"},children:n?"Update":"Add"}),e.jsx(I,{variant:"contained",color:"",sx:{backgroundColor:"white",width:"100px",borderRadius:"10px",padding:"10px",fontWeight:"500",fontSize:"18px"},onClick:()=>m(),children:"Cancel"})]})]})})})]})}const ke={title:"",description:"",sections:[],category:"",status:"active",instructor_ids:"",participant_ids:[],course_image:null},Te=48,De=8,Q={PaperProps:{style:{maxHeight:Te*4.5+De,width:250}}},Re=ie("input")({clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:1});function Pe(){const{id:T}=xe(),{user:m}=ue(),U=me(),{categoryData:E,refetchCategories:n,instructors:F,refetchInstructors:q,participants:L,refetchParticipants:A}=we(),{showToast:v}=he(),R=ve(),[l,y]=k.useState(!1),[s,d]=k.useState(ke),[w,S]=k.useState([]),[j,h]=k.useState(!1),[b,g]=k.useState(null);console.log("Update Data",s);const D=async r=>{try{const{data:a,status:f,error:i}=await R(`/api/categories/finduserbycategory/${r}`,"GET");f===200?S(a.data):v(i,"error")}catch{v("Failed to fetch course.","error")}},se=async()=>{try{const{data:r,status:a,error:f}=await R(`/api/course/${T}`,"GET");if(a===200){const i=r.course;i.category=i.category_id?._id,i.instructor_ids=i.instructor_ids||"",i.participant_ids=i.participant_ids?.map(p=>p._id)||[],i.course_image=i.course_image,i.status=i.status===!0?"active":"inactive",d(i),m?.user_type===1&&i.instructor_ids&&D(i.instructor_ids)}else v(f,"error")}catch{v("Failed to fetch course.","error")}};k.useEffect(()=>{T?(m?.user_type===1?q():A(),se(),m?.user_type===2&&n()):(m?.user_type===1?q():A(),m?.user_type===2&&n())},[]);const V=m?.user_type===1?w:E,re=r=>{g(r),h(!0)},ae=()=>{h(!1),g(null)},ne=Z({title:z().required("Course Title required"),description:z().required("Description required"),instructor_ids:m?.user_type===1?z().required("Instructor required"):z(),participant_ids:m?.user_type===2?O().min(1,"At least one participant required"):O(),category:z().required("Category required")}),oe=async r=>{const a=new FormData;a.append("title",r.title),a.append("description",r.description),a.append("category_id",r.category),a.append("status",r.status==="active"),m?.user_type===1?a.append("instructor_ids",r.instructor_ids):a.append("participant_ids",JSON.stringify(r.participant_ids)),r.course_image instanceof File&&a.append("course_image",r.course_image),(r.sections||[]).forEach((i,p)=>{a.append(`sections[${p}].title`,i.title),a.append(`sections[${p}].lesson`,i.lesson),i.image?.forEach((u,t)=>{u instanceof File&&a.append(`sections[${p}].image`,u)}),i.video?.forEach((u,t)=>{u instanceof File&&a.append(`sections[${p}].video`,u)}),i.document?.forEach((u,t)=>{u instanceof File&&a.append(`sections[${p}].document`,u)})}),y(!0);try{if(T){const{data:i,status:p,error:u}=await R(`/api/course/update/${T}`,"PUT",a,!0);p===200?(v(i.message,"success"),U("/admin/course")):v(u,"error")}else{const{data:i,status:p,error:u}=await R("/api/course/create","POST",a,!0);p===200?(v(i.message,"success"),U("/admin/course")):v(u,"error")}}catch{v("Failed to update course.","error")}finally{y(!1)}};return e.jsxs(c,{style:{padding:"1.25rem",height:"100%",overflowY:"auto"},children:[e.jsxs("div",{children:[e.jsxs(o,{variant:"subtitle1",fontSize:"1.5rem",fontWeight:500,children:[T?"Update":"Create"," Course"]}),e.jsx(o,{variant:"subtitle2",fontWeight:500,children:"Details about the course"})]}),e.jsx(ge,{container:!0,spacing:2,justifyContent:"center",my:2,children:e.jsx(ee,{initialValues:s,enableReinitialize:!0,validationSchema:ne,onSubmit:oe,children:({errors:r,handleChange:a,values:f,handleBlur:i,touched:p,setFieldValue:u})=>e.jsxs(te,{style:{width:"100%",display:"flex",flexDirection:"column",gap:"1rem",marginTop:"0.5rem"},children:[e.jsxs(c,{sx:{display:"flex",gap:"2rem",width:"100%"},children:[e.jsxs(_,{fullWidth:!0,error:!!r.title,children:[e.jsx(o,{sx:{mx:.5,mb:.4},children:"Course Title"}),e.jsx(H,{id:"title",name:"title",type:"text",placeholder:"Course Title",value:f.title,onChange:a,onBlur:i,error:p.title&&!!r.title,helperText:p.title&&r.title})]}),e.jsxs(_,{fullWidth:!0,children:[e.jsx(o,{sx:{mx:.5,mb:.4},children:"Status"}),e.jsxs(fe,{sx:{padding:"10px 0px",gap:"1rem"},children:[e.jsx(J,{checked:f.status==="active",onChange:a,value:"active",label:"Active",name:"status",size:"md"}),e.jsx(J,{checked:f.status==="inactive",onChange:a,value:"inactive",label:"Inactive",name:"status",size:"md"})]})]})]}),e.jsxs(c,{sx:{display:"flex",gap:"2rem",width:"100%"},children:[m?.user_type===1?e.jsxs(_,{fullWidth:!0,error:!!r.instructor_ids,children:[e.jsx(o,{sx:{mx:.5,mb:.4},children:"Instructors"}),e.jsxs(G,{displayEmpty:!0,id:"instructor_ids",name:"instructor_ids",MenuProps:Q,value:f.instructor_ids||[],onChange:t=>{a(t);const x=t.target.value;x&&(D(x),u("category",""))},onBlur:i,renderValue:t=>{if(!t||t.length===0)return e.jsx("span",{style:{color:"#aaa"},children:"Select Instructors"});const x=F.find(C=>C._id===t);return x?`${x.first_name} ${x.last_name}`:""},children:[e.jsx(W,{disabled:!0,value:"",children:e.jsx("em",{children:"Select Instructors"})}),F.map(t=>e.jsx(W,{value:t._id,children:e.jsx(Y,{primary:`${t.first_name} ${t.last_name}`})},t._id))]}),r.instructor_ids&&e.jsx(P,{children:r.instructor_ids})]}):e.jsxs(_,{fullWidth:!0,error:!!r.participant_ids,children:[e.jsx(o,{sx:{mx:.5,mb:.4},children:"Participants"}),e.jsxs(G,{multiple:!0,displayEmpty:!0,label:"",id:"participant_ids",name:"participant_ids",MenuProps:Q,value:f.participant_ids||[],onChange:a,onBlur:i,renderValue:t=>!t||t.length===0?e.jsx("span",{style:{color:"#aaa"},children:"Select Participants"}):t.map(x=>{const C=L.find(M=>M._id===x);return C?`${C.first_name} ${C.last_name}`:""}).join(", "),children:[e.jsx(W,{value:"",disabled:!0,children:e.jsx("em",{children:"Select Participants"})}),L.map(t=>e.jsxs(W,{value:t._id,children:[e.jsx(je,{color:"black",checked:f.participant_ids?.includes(t._id)}),e.jsx(Y,{primary:`${t.first_name} ${t.last_name}`})]},t._id))]}),r.participant_ids&&e.jsx(P,{children:r.participant_ids})]}),e.jsxs(_,{fullWidth:!0,error:!!r.category,children:[e.jsx(o,{sx:{mx:.5,mb:.4},children:"Category"}),e.jsxs(G,{id:"category",name:"category",value:f.category,onChange:a,onBlur:i,displayEmpty:!0,renderValue:t=>{const x=V.find(C=>C._id===t);return x?x.name:e.jsx("span",{style:{color:"#aaa"},children:"Select Category"})},children:[e.jsx(W,{disabled:!0,value:"",children:e.jsx("em",{children:"Select Category"})}),V.length>0&&V.map(t=>e.jsx(W,{value:t._id,children:t.name},t._id))]}),p.category&&!!r.category&&e.jsx(P,{children:r.category})]})]}),e.jsxs(c,{sx:{display:"flex",gap:"2rem",width:"100%"},children:[e.jsxs(_,{fullWidth:!0,error:!!r.description,children:[e.jsx(o,{sx:{mx:.5,mb:.4},children:"Description"}),e.jsx(H,{id:"description",type:"text",multiline:!0,rows:4,placeholder:"Description",value:f.description,onChange:a,onBlur:i,error:p.description&&!!r.description,helperText:p.description&&r.description})]}),e.jsxs(_,{fullWidth:!0,children:[e.jsx(o,{sx:{mx:.5,mb:.4},children:"Course Image"}),e.jsxs(c,{component:"label",role:void 0,tabIndex:-1,sx:{border:"1px dashed #ccc",borderRadius:"8px",p:"6px"},children:[f.course_image?.preview?e.jsxs(c,{sx:{display:"flex",justifyContent:"center",position:"relative"},children:[e.jsx("img",{src:f.course_image.preview,alt:"Course Preview",style:{width:120,height:120,objectFit:"cover",borderRadius:8}}),e.jsx($,{sx:{position:"absolute",top:0,right:0,padding:"4px",color:"#fff",bgcolor:"rgba(0,0,0,0.6)","&:hover":{bgcolor:"black"}},onClick:t=>{t.stopPropagation(),u("course_image",null)},children:e.jsx(B,{fontSize:"small"})})]}):e.jsxs(c,{sx:{py:4,cursor:"pointer"},children:[e.jsx(o,{textAlign:"center",fontWeight:700,children:"Drop file here or click to upload"}),e.jsx(o,{textAlign:"center",children:"JPG, PNG, PDF, or Video files. Max file size 3MB."})]}),e.jsx(Re,{type:"file",id:"course_image",name:"course_image",accept:"image/*",onBlur:i,onChange:t=>{const x=t.currentTarget.files[0];if(x){const C=Object.assign(x,{preview:URL.createObjectURL(x)});u("course_image",C)}}})]})]})]}),e.jsxs(c,{children:[s?.sections.length>0&&e.jsx(o,{sx:{mx:.5,mb:.4},children:"Sections"}),s?.sections.length>0&&s?.sections.map((t,x)=>e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",my:1,p:2,backgroundColor:"#f9f9f9",border:"1px solid #ccc",borderRadius:"8px"},children:[e.jsx(c,{children:e.jsx(o,{variant:"h6",children:t.title})}),e.jsxs(c,{sx:{display:"flex",gap:"10px"},children:[e.jsx(I,{variant:"outlined",color:"primary",onClick:()=>re(t),startIcon:e.jsx(ye,{}),children:"Edit"}),e.jsx(I,{variant:"outlined",color:"error",startIcon:e.jsx(be,{}),onClick:()=>{const C=s?.sections.filter(M=>M!==t);d({...s,sections:C})},children:"Delete"})]})]},x))]}),e.jsx(c,{children:e.jsx(I,{variant:"contained",color:"primary",sx:{bgcolor:"black",borderRadius:"10px",padding:"5px 10px",fontWeight:"500",fontSize:"18px"},startIcon:e.jsx(_e,{}),onClick:()=>{g(null),h(!0)},children:"Add Section"})}),e.jsxs(c,{sx:{display:"flex",justifyContent:"end",gap:"10px",width:"100%",my:2},children:[e.jsx(I,{loading:l,type:"submit",variant:"contained",color:"primary",sx:{backgroundColor:"black",width:"100px",borderRadius:"10px",padding:"10px",fontWeight:"500",fontSize:"18px"},children:T?"Update":"Save"}),e.jsx(I,{variant:"contained",color:"",sx:{backgroundColor:"white",width:"100px",borderRadius:"10px",padding:"10px",fontWeight:"500",fontSize:"18px"},onClick:()=>U("/admin/course"),children:"Cancel"})]})]})})}),e.jsx(Se,{open:j,courseRecord:s,setCourseRecord:d,handleClose:ae,selectedSection:b})]})}export{Pe as default};
