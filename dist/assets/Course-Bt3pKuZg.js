import{f as W,u as z,a as B,r,w as F,W as L,e as U,j as t,B as o,K as H,b as q,ah as K,Q,I as S,R as V,U as Y,T as J,l as X,m as Z,S as ee,p as te,x as se,y as ae,P as re}from"./index-MF_D1kqz.js";function ie(){const{showToast:n}=W(),{user:d}=z(),x=B(),l=U(),[f,i]=r.useState(!1),[j,T]=r.useState(null),[I,u]=r.useState([]),[w,y]=r.useState({}),[A,_]=r.useState(""),[v,C]=r.useState(!1),[h,b]=r.useState(0),[E,N]=r.useState(""),c=F(d,"course","edit"),M=d?.user_type===1,g=async()=>{i(!0);try{const{data:e,status:s,error:a}=await l(`/api/course?limit=15&page=${h+1}`,"GET");s===200?(u(e.data),y(e.pagination)):(n(a,"error"),u([]))}catch{n("Failed to fetch users.","error")}finally{i(!1)}};r.useEffect(()=>{g()},[h]);const m=()=>{C(!1)},P=e=>{_(e.title||""),T(e._id),C(!0)},R=r.useMemo(()=>L.debounce(async e=>{i(!0);try{const{data:s,status:a,error:p}=await l(`/api/course?search=${e}`,"GET");a===200?(u(s.data),y(s.pagination)):n(p,"error")}catch(s){console.error("API Error:",s)}finally{i(!1)}},300),[]),D=e=>{const s=e.target.value;N(s),R(s)},O=async(e,s)=>{try{const{data:a,status:p,error:k}=await l("/api/course/status","PATCH",{id:e,status:s});p===200?(n(a?.message,"success"),g()):n(k,"error")}catch{n("Failed to change status.","error")}finally{i(!1),m()}},$=async()=>{i(!0);try{const{data:e,status:s,error:a}=await l("/api/course/delete","DELETE",{id:j});s===200?(n(e?.message,"success"),g()):n(a,"error")}catch{n("Failed to delete category.","error")}finally{i(!1),m()}},G=[{field:"title",headerName:"TITLE",minWidth:150,flex:.5,headerAlign:"start",align:"start"},{field:"category",headerName:"CATEGORY",flex:.5,headerAlign:"start",align:"start",valueGetter:(e,s)=>`${s.category_id?.name||"No Category"}`},{field:"Instructors",headerName:`${M?"INSTRUCTORS":"PARTICIPANTS"}`,flex:.5,headerAlign:"start",align:"start",...d?.user_type===1?{valueGetter:(e,s)=>`${s.assigned_to?.first_name} ${s.assigned_to?.last_name}`}:{renderCell:e=>{const s=e?.row?.participant_ids||[];return t.jsx(o,{sx:{height:"37px",width:"100%"},children:t.jsx(H,{multiple:!0,displayEmpty:!0,fullWidth:!0,value:s.map(a=>a._id),sx:{height:"100%"},renderValue:a=>t.jsx("span",{style:{color:a.length===0?"#aaa":"inherit"},children:a.length===0?"No Participants":"Selected Participants"}),children:s.map(a=>t.jsx(q,{value:a._id,children:t.jsx(K,{primary:`${a.first_name} ${a.last_name}`})},a._id))})})}}},{field:"status",headerName:"STATUS",minWidth:150,headerAlign:"start",align:"start",renderCell:e=>t.jsx(o,{children:t.jsx(Q,{color:"success",checked:e.row.status,disabled:!c,onClick:()=>O(e.row._id,!e.row.status)})})},{field:"Action",headerName:"ACTIONS",minWidth:150,flex:.5,headerAlign:"center",align:"center",renderCell:e=>t.jsxs(o,{direction:"row",spacing:1,children:[t.jsx(S,{disabled:!c,onClick:()=>x(`/admin/course/edit-course/${e.row._id}`),children:t.jsx(V,{fontSize:"medium"})}),t.jsx(S,{disabled:!c,onClick:()=>P(e.row),children:t.jsx(Y,{fontSize:"medium"})})]})}];return t.jsxs(o,{style:{padding:"1.25rem",height:"100%"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(J,{variant:"subtitle1",fontSize:"1.5rem",fontWeight:500,children:"Course"}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[t.jsx(X,{size:"small",placeholder:"Search course...",variant:"outlined",value:E,onChange:D,InputProps:{endAdornment:t.jsx(Z,{position:"end",children:t.jsx(ee,{})})}}),c&&t.jsx(te,{sx:{bgcolor:"black",color:"white",fontWeight:"500"},variant:"outlined",startIcon:t.jsx(se,{}),onClick:()=>x("/admin/course/add-course"),children:"Add Course"})]})]}),t.jsx(o,{sx:{marginTop:"10px",height:"100%"},children:t.jsx(ae,{className:"custom-datagrid",rows:f?[]:I,columns:G,getRowId:e=>e._id,rowCount:w?.total_records,paginationMode:"server",paginationModel:{page:h,pageSize:15},onPaginationModelChange:e=>{b(e.page)},loading:f,disableRowSelectionOnClick:!0,disableColumnMenu:!0,rowHeight:50,sx:{height:"calc(100% - 5.3rem)",borderRadius:"10px","& .MuiDataGrid-cell:focus":{outline:"none"},"& .MuiDataGrid-cell:focus-within":{outline:"none"},"& .MuiDataGrid-columnHeader":{backgroundColor:"rgb(250, 250, 251)"}}})}),t.jsx(re,{open:v,title:A,description:"This course will be deleted permanently.",onClose:m,onDelete:$})]})}export{ie as default};
