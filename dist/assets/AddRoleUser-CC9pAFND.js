import{Y as k,u as N,a as I,f as L,r as x,g as U,h as u,j as e,T as r,F as $,i as E,A as V,s as Y,Z as O,B as m,k as l,l as c,_ as Z,$ as w,D as v,a0 as G,a1 as H,a2 as J,m as K,I as Q,V as X,n as ee,p as S,e as ae,a3 as B}from"./index-dsHidcQ8.js";const se={first_name:"",last_name:"",email:"",mobile_no:"",dob:null,status:"active",role:"",password:""};function ie(){const{id:p}=k(),{user:f}=N(),b=I(),{showToast:d}=L(),j=ae();console.log("user::",f);const[D,y]=x.useState(!1),[P,T]=x.useState(se),[_,z]=x.useState(!1),[h,A]=x.useState(null),F=()=>z(a=>!a),W=async()=>{try{const{data:a,status:s,error:i}=await j(`/api/user/${p}`,"GET");if(s===200){const t=a.user;t.status=t.status===!0?"active":"inactive",t.dob=t.dob?B(t.dob):null,t.user_type===1?t.role="Admin":t.user_type===2?t.role="Member":t.user_type===3?t.role="Participant":t.role="Unknown",T(t)}else d(i,"error")}catch{d("Failed to fetch profile.","error")}};x.useEffect(()=>{p&&W()},[p]);const R=a=>{const s=a[0];s&&(s.preview=URL.createObjectURL(s),A(s))},q=U({first_name:u().required("First Name required"),last_name:u().required("Last Name required"),mobile_no:u().max(12).required("Mobile Number required"),email:u().email("Invalid email format").required("Email is required"),password:u().required("Password is required").min(6,"Password must be at least 6 characters").matches(/[A-Z]/,"Must contain at least one uppercase letter").matches(/[a-z]/,"Must contain at least one lowercase letter").matches(/[0-9]/,"Must contain at least one number").matches(/[@$!%*?&]/,"Must contain at least one special character")}),C=async a=>{const s=new FormData;s.append("first_name",a.first_name),s.append("last_name",a.last_name),s.append("status",a.status==="active"),s.append("email",a.email),s.append("mobile_no",a.mobile_no),s.append("password",a.password),s.append("user_type",f?.user_type===1?2:3),s.append("dob",a.dob?B(a.dob).format("YYYY-MM-DD"):""),h instanceof File&&s.append("profile_image",h),y(!0);try{if(p){const{data:i,status:t,error:n}=await j(`/api/user/update/${p}`,"PUT",s,!0);t===200?(d(i.message,"success"),b("/admin/role-user")):d(n,"error")}else{const{data:i,status:t,error:n}=await j("/api/user/create","POST",s,!0);t===200?(d(i.message,"success"),b("/admin/role-user")):d(n,"error")}}catch{d("Failed to update user.","error")}finally{y(!1)}};return e.jsxs("div",{style:{padding:"1.25rem",height:"100%",overflowY:"auto"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:e.jsx(r,{variant:"subtitle1",fontSize:"1.5rem",fontWeight:500,children:"Basic User Detail"})}),e.jsx($,{initialValues:P,enableReinitialize:!0,validationSchema:q,onSubmit:C,children:({errors:a,handleChange:s,values:i,setFieldValue:t,handleBlur:n,touched:o})=>e.jsxs(E,{style:{width:"100%",display:"flex",flexDirection:"column",gap:"10px"},children:[e.jsxs("div",{style:{marginTop:"10px",display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx(V,{src:h?.preview||i.profile_image,...Y(`${i.first_name} ${i.last_name}`),sx:{width:90,height:90,fontSize:"3rem",bgcolor:"rgb(229, 229, 229)",color:"black",fontWeight:"500",borderRadius:"10px"}}),e.jsxs("div",{children:[e.jsx(r,{variant:"h5",fontSize:"19px",children:"Profile picture"}),e.jsxs(r,{variant:"caption",fontSize:"0.75rem",children:["Accepting file type .png .jpg .jpeg ",e.jsx("br",{})," Max size 3MB"]})]}),e.jsx(O,{onDrop:R,name:"Upload",selectedFile:h,multiple:!1,accept:{"image/*":[]}})]}),e.jsxs(m,{sx:{display:"flex",gap:"3rem",width:"100%"},children:[e.jsxs(l,{fullWidth:!0,error:!!a.first_name,children:[e.jsx(r,{sx:{mx:.5,mb:.4},required:!0,children:"First Name"}),e.jsx(c,{id:"first_name",type:"text",placeholder:"First Name",value:i.first_name,onChange:s,onBlur:n,error:o.first_name&&!!a.first_name,helperText:o.first_name&&a.first_name})]}),e.jsxs(l,{fullWidth:!0,error:!!a.last_name,children:[e.jsx(r,{sx:{mx:.5,mb:.4},children:"Last Name"}),e.jsx(c,{id:"last_name",type:"text",placeholder:"Last Name",value:i.last_name,onChange:s,onBlur:n,error:o.last_name&&!!a.last_name,helperText:o.last_name&&a.last_name})]})]}),e.jsxs(m,{sx:{display:"flex",gap:"3rem",width:"100%"},children:[e.jsxs(l,{fullWidth:!0,error:!!a.mobile_no,children:[e.jsx(r,{sx:{mx:.5,mb:.4},children:"Mobile Number"}),e.jsx(c,{id:"mobile_no",type:"number",maxRows:12,placeholder:"Mobile Number",value:i.mobile_no,onChange:s,onBlur:n,error:o.mobile_no&&!!a.mobile_no,helperText:o.mobile_no&&a.mobile_no})]}),e.jsxs(l,{fullWidth:!0,error:!!a.email,children:[e.jsx(r,{sx:{mx:.5,mb:.4},children:"Email Address"}),e.jsx(c,{id:"email",type:"text",placeholder:"Email",value:i.email,onChange:g=>{const M=g.target.value.toLowerCase();s({target:{name:"email",value:M}})},onBlur:n,error:o.email&&!!a.email,helperText:o.email&&a.email})]})]}),e.jsx(m,{sx:{display:"flex",gap:"3rem",width:"100%"},children:e.jsxs(l,{fullWidth:!0,children:[e.jsx(r,{sx:{mx:.5,mb:.4},children:"Status"}),e.jsxs(Z,{sx:{padding:"10px 0px",gap:"1rem"},children:[e.jsx(w,{checked:i.status==="active",onChange:s,value:"active",label:"Active",name:"status",size:"md"}),e.jsx(w,{checked:i.status==="inactive",onChange:s,value:"inactive",label:"Inactive",name:"status",size:"md"})]})]})}),e.jsx(v,{sx:{my:2,borderColor:"rgba(0, 0, 0, 0.12)"}}),e.jsx(r,{variant:"subtitle1",fontSize:"1.5rem",fontWeight:500,children:"Position Preference Detail"}),e.jsxs(m,{sx:{display:"flex",gap:"3rem",width:"100%"},children:[e.jsxs(l,{fullWidth:!0,error:!!a.dob,children:[e.jsx(r,{sx:{mx:.5,mb:.4},children:"Date of Birth"}),e.jsx(G,{dateAdapter:H,children:e.jsx(J,{id:"dob",value:i.dob,onChange:g=>t("dob",g)})})]}),e.jsxs(l,{fullWidth:!0,children:[e.jsx(r,{sx:{mx:.5,mb:.4},children:"Role"}),e.jsx(c,{id:"role",type:"text",placeholder:"Role",value:f?.user_type===1?"Member":f?.user_type===2?"Participant":"",disabled:!0,onChange:s,onBlur:n,error:o.role&&!!a.role,helperText:o.role&&a.role})]})]}),e.jsx(v,{sx:{my:2,borderColor:"rgba(0, 0, 0, 0.12)"}}),e.jsx(r,{variant:"subtitle1",fontSize:"1.5rem",fontWeight:500,children:"Security Detail"}),e.jsxs(m,{sx:{display:"flex",gap:"3rem",width:"100%"},children:[e.jsxs(l,{fullWidth:!0,error:!!a.email,children:[e.jsx(r,{sx:{mx:.5,mb:.4},children:"Password"}),e.jsx(c,{id:"password",type:_?"text":"password",placeholder:"Password",value:i.password,onChange:s,onBlur:n,error:o.password&&!!a.password,helperText:o.password&&a.password,InputProps:{endAdornment:e.jsx(K,{position:"end",children:e.jsx(Q,{onClick:F,edge:"end",children:_?e.jsx(X,{}):e.jsx(ee,{})})})}})]}),e.jsx(l,{fullWidth:!0})]}),e.jsxs(m,{sx:{display:"flex",justifyContent:"end",gap:"10px",width:"100%",mb:5},children:[e.jsx(S,{loading:D,type:"submit",variant:"contained",color:"primary",sx:{backgroundColor:"black",width:"100px",borderRadius:"10px",padding:"10px",fontWeight:"500",fontSize:"18px"},children:"Save"}),e.jsx(S,{variant:"contained",color:"",sx:{backgroundColor:"white",width:"100px",borderRadius:"10px",padding:"10px",fontWeight:"500",fontSize:"18px"},onClick:()=>b("/admin/role-user"),children:"Cancel"})]})]})})]})}export{ie as default};
