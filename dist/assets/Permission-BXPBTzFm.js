import{a4 as m,a5 as T,r as h,a6 as C,j as s,a7 as W,a8 as w,a9 as j,aa as R,ab as z,ac as k,ad as H,a as A,Y as q,f as V,B as U,T as y,ae as D,af as g,ag as F,Q as $,p as B,e as G}from"./index-CcV8hKYk.js";function L(e){return m("MuiTable",e)}T("MuiTable",["root","stickyHeader"]);const Q=e=>{const{classes:o,stickyHeader:t}=e;return R({root:["root",t&&"stickyHeader"]},L,o)},X=w("table",{name:"MuiTable",slot:"Root",overridesResolver:(e,o)=>{const{ownerState:t}=e;return[o.root,t.stickyHeader&&o.stickyHeader]}})(z(({theme:e})=>({display:"table",width:"100%",borderCollapse:"collapse",borderSpacing:0,"& caption":{...e.typography.body2,padding:e.spacing(2),color:(e.vars||e).palette.text.secondary,textAlign:"left",captionSide:"bottom"},variants:[{props:({ownerState:o})=>o.stickyHeader,style:{borderCollapse:"separate"}}]}))),P="table",Y=h.forwardRef(function(o,t){const r=C({props:o,name:"MuiTable"}),{className:c,component:a=P,padding:i="normal",size:l="medium",stickyHeader:d=!1,...x}=r,f={...r,component:a,padding:i,size:l,stickyHeader:d},n=Q(f),p=h.useMemo(()=>({padding:i,size:l,stickyHeader:d}),[i,l,d]);return s.jsx(W.Provider,{value:p,children:s.jsx(X,{as:a,role:a===P?null:"table",ref:t,className:j(n.root,c),ownerState:f,...x})})});function I(e){return m("MuiTableBody",e)}T("MuiTableBody",["root"]);const J=e=>{const{classes:o}=e;return R({root:["root"]},I,o)},K=w("tbody",{name:"MuiTableBody",slot:"Root"})({display:"table-row-group"}),Z={variant:"body"},N="tbody",ee=h.forwardRef(function(o,t){const r=C({props:o,name:"MuiTableBody"}),{className:c,component:a=N,...i}=r,l={...r,component:a},d=J(l);return s.jsx(k.Provider,{value:Z,children:s.jsx(K,{className:j(d.root,c),as:a,ref:t,role:a===N?null:"rowgroup",ownerState:l,...i})})});function se(e){return m("MuiTableContainer",e)}T("MuiTableContainer",["root"]);const oe=e=>{const{classes:o}=e;return R({root:["root"]},se,o)},te=w("div",{name:"MuiTableContainer",slot:"Root"})({width:"100%",overflowX:"auto"}),ae=h.forwardRef(function(o,t){const r=C({props:o,name:"MuiTableContainer"}),{className:c,component:a="div",...i}=r,l={...r,component:a},d=oe(l);return s.jsx(te,{ref:t,as:a,className:j(d.root,c),ownerState:l,...i})});function re(e){return m("MuiTableHead",e)}T("MuiTableHead",["root"]);const ne=e=>{const{classes:o}=e;return R({root:["root"]},re,o)},le=w("thead",{name:"MuiTableHead",slot:"Root"})({display:"table-header-group"}),ie={variant:"head"},_="thead",ce=h.forwardRef(function(o,t){const r=C({props:o,name:"MuiTableHead"}),{className:c,component:a=_,...i}=r,l={...r,component:a},d=ne(l);return s.jsx(k.Provider,{value:ie,children:s.jsx(le,{as:a,className:j(d.root,c),ref:t,role:a===_?null:"rowgroup",ownerState:l,...i})})});function de(e){return m("MuiTableRow",e)}const E=T("MuiTableRow",["root","selected","hover","head","footer"]),pe=e=>{const{classes:o,selected:t,hover:r,head:c,footer:a}=e;return R({root:["root",t&&"selected",r&&"hover",c&&"head",a&&"footer"]},de,o)},ue=w("tr",{name:"MuiTableRow",slot:"Root",overridesResolver:(e,o)=>{const{ownerState:t}=e;return[o.root,t.head&&o.head,t.footer&&o.footer]}})(z(({theme:e})=>({color:"inherit",display:"table-row",verticalAlign:"middle",outline:0,[`&.${E.hover}:hover`]:{backgroundColor:(e.vars||e).palette.action.hover},[`&.${E.selected}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:H(e.palette.primary.main,e.palette.action.selectedOpacity),"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:H(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity)}}}))),O="tr",M=h.forwardRef(function(o,t){const r=C({props:o,name:"MuiTableRow"}),{className:c,component:a=O,hover:i=!1,selected:l=!1,...d}=r,x=h.useContext(k),f={...r,component:a,hover:i,selected:l,head:x&&x.variant==="head",footer:x&&x.variant==="footer"},n=pe(f);return s.jsx(ue,{as:a,ref:t,className:j(n.root,c),role:a===O?null:"row",ownerState:f,...d})});function he(){const e=A(),{id:o}=q(),{showToast:t}=V(),r=G(),[c,a]=h.useState(!1),[i,l]=h.useState({}),d=async()=>{a(!0);try{const{data:n,status:p,error:u}=await r(`/api/user/permissions/${o}`,"GET");p===200?l(n.permission):t(u,"error")}catch{t("Failed to fetch profile.","error")}finally{a(!1)}};h.useEffect(()=>{o&&d()},[o]);const x=(n,p)=>{l(u=>({...u,[n]:u[n].map(b=>b._id===p?{...b,is_access:!b.is_access}:b)}))},f=async()=>{a(!0);try{const n={id:o,permissions:[]};Object.values(i).forEach(v=>{v.forEach(S=>{n.permissions.push({id:S._id,is_access:S.is_access})})});const{data:p,status:u,error:b}=await r("/api/user/update-permissions","PUT",n);u===200?(t(p.message,"success"),e("/admin/role-user")):t(b||"Something went wrong","error")}catch{t("Unexpected error occurred","error")}finally{a(!1)}};return s.jsxs(U,{style:{padding:"1.25rem",height:"100%"},children:[s.jsx(y,{variant:"subtitle1",fontSize:"1.5rem",fontWeight:500,children:"Edit User Permissions"}),s.jsx(ae,{component:D,sx:{marginTop:"1rem",maxHeight:"calc(100vh - 200px)"},children:s.jsxs(Y,{sx:{minWidth:700},children:[s.jsx(ce,{sx:{backgroundColor:"black"},children:s.jsxs(M,{children:[s.jsx(g,{children:s.jsx(y,{color:"white",children:"Module"})}),s.jsx(g,{align:"start",children:s.jsx(y,{color:"white",children:"View"})}),s.jsx(g,{align:"start",children:s.jsx(y,{color:"white",children:"Edit"})})]})}),s.jsx(ee,{children:c?s.jsx(M,{children:s.jsx(g,{colSpan:3,align:"center",children:s.jsx(F,{size:50,variant:"indeterminate",color:"inherit"})})}):Object.entries(i).map(([n,p])=>{const u=p.find(v=>v.action==="view"),b=p.find(v=>v.action==="edit");return s.jsxs(M,{children:[s.jsx(g,{children:s.jsx(y,{variant:"h6",children:n})}),s.jsx(g,{align:"start",sx:{padding:"16px 0px"},children:u?s.jsx($,{color:"success",checked:u.is_access,onChange:()=>x(n,u._id)}):s.jsx(y,{color:"black",children:"No View"})}),s.jsx(g,{align:"start",sx:{padding:"16px 0px"},children:b?s.jsx($,{color:"success",checked:b.is_access,onChange:()=>x(n,b._id)}):s.jsx(y,{color:"black",children:"No Edit"})})]},n)})})]})}),s.jsxs(U,{sx:{display:"flex",justifyContent:"end",gap:"10px",width:"100%",mt:2},children:[s.jsx(B,{loading:c,type:"submit",variant:"contained",color:"primary",sx:{backgroundColor:"black",width:"100px",borderRadius:"10px",padding:"10px",fontWeight:"500",fontSize:"18px"},onClick:f,children:"Save"}),s.jsx(B,{variant:"contained",color:"",sx:{backgroundColor:"white",width:"100px",borderRadius:"10px",padding:"10px",fontWeight:"500",fontSize:"18px"},onClick:()=>e("/admin/role-user"),children:"Cancel"})]})]})}export{he as default};
