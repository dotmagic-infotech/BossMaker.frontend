import{c as X,j as e,r as k,g as Z,ai as O,h as z,z as ce,E as le,I as A,H as B,J as de,F as ee,i as te,k as _,T as o,l as H,p as I,a8 as ie,q as R,B as c,D as pe,Y as ue,u as xe,a as me,f as he,aj as ge,G as fe,_ as je,$ as J,K as G,b as q,ah as Y,o as ye,R as be,U as _e,x as ve,e as we}from"./index-CVsBOibh.js";import{u as Ce}from"./CategoryContext-BCuvu8lz.js";const Ie=X(e.jsx("path",{d:"M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m0 14H8V4h12zM4 6H2v14c0 1.1.9 2 2 2h14v-2H4zm12 6V9c0-.55-.45-1-1-1h-2v5h2c.55 0 1-.45 1-1m-2-3h1v3h-1zm4 2h1v-1h-1V9h1V8h-2v5h1zm-8 0h1c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1H9v5h1zm0-2h1v1h-1z"})),Se=X(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m-2.5-3.5 7-4.5-7-4.5z"})),K={title:"",lesson:"",image:[],video:[],document:[]},N=ie("input")({clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:1});function ke({open:T,handleClose:m,courseRecord:P,setCourseRecord:E,selectedSection:n}){const[F,U]=k.useState(!1),[L,$]=k.useState(K);k.useEffect(()=>{if(n){const d=(r,p)=>r.map(w=>({name:w?.stored_name.split("/").pop(),preview:w?.stored_name,lastModified:Date.now(),type:p,url:w,createdAt:new Date().toISOString()})),y={title:n.title||"",lesson:n.lesson||"",image:n.image[0]?.type?n.image:d(n.image||[],"image/*"),video:n.video[0]?.type?n.video:d(n.video||[],"video/*"),document:n.document[0]?.type?n.document:d(n.document||[],"application/*")};$(y)}else $(K)},[n]);const v=Z({title:z().required("Section Title is required"),image:O().min(1,"At least one image is required").required("Image is required"),video:O().min(1,"At least one video is required").required("Video is required"),document:O().min(1,"At least one document is required").required("Document is required")}),W=async d=>{if(U(!0),n)E(y=>{const r=y.sections.map(p=>p._id===n._id?{...p,...d}:p);return console.log("prev:",y),{...y,sections:r}});else{const y=P?.sections?.length+1||1,r={...d,_id:y};E(p=>({...p,sections:[...p.sections,r]}))}U(!1),m()};return e.jsxs(ce,{fullWidth:!0,open:T,sx:{borderRadius:"12px"},onClose:m,children:[e.jsxs(le,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[n?"Update":"Add"," Section",e.jsx(A,{color:"inherit",sx:{border:"1px solid black"},onClick:m,children:e.jsx(B,{})})]}),e.jsx(de,{dividers:!0,children:e.jsx(ee,{initialValues:L,enableReinitialize:!0,validationSchema:v,onSubmit:W,children:({errors:d,handleChange:y,values:r,handleBlur:p,touched:w,setFieldValue:S})=>e.jsxs(te,{style:{width:"100%",display:"flex",flexDirection:"column",gap:"1rem",marginTop:"0.5rem"},children:[e.jsxs(_,{fullWidth:!0,children:[e.jsx(o,{sx:{mx:.5,mb:.4},children:"Section Title"}),e.jsx(H,{name:"title",type:"text",placeholder:"Section Title",value:r.title,onChange:y,onBlur:p,error:w.title&&!!d.title,helperText:w.title&&d.title})]}),e.jsxs(_,{fullWidth:!0,children:[e.jsx(o,{sx:{mx:.5,mb:.4},children:"Text Lesson"}),e.jsx(H,{name:"lesson",type:"text",multiline:!0,rows:4,placeholder:"Text Lesson",value:r.lesson,onChange:y})]}),e.jsxs(_,{fullWidth:!0,children:[e.jsx(o,{sx:{mx:.5,mb:.4},children:"Image Upload"}),e.jsxs(I,{component:"label",role:void 0,variant:"outlined",tabIndex:-1,className:"upload-button",children:["Upload Image",e.jsx(N,{type:"file",name:"image",accept:"image/*",multiple:!0,onBlur:p,onChange:j=>{const b=Array.from(j.currentTarget.files||[]).map(g=>Object.assign(g,{preview:URL.createObjectURL(g)}));S("image",[...r.image||[],...b])}})]}),w.image&&!!d.image&&e.jsx(R,{error:!0,children:d.image}),r.image&&r.image.length>0&&e.jsx(c,{mt:2,display:"flex",flexWrap:"wrap",gap:2,children:r.image.map((j,h)=>e.jsxs(c,{display:"flex",alignItems:"center",gap:1,sx:{position:"relative",border:"1px solid #ccc",borderRadius:"8px",padding:"8px 12px",backgroundColor:"#f9f9f9",width:"146px"},children:[e.jsx(A,{sx:{position:"absolute",top:"-11px",right:"-11px",padding:"4px",color:"#fff",bgcolor:"black","&:hover":{bgcolor:"black"}},onClick:()=>{const b=r.image.filter((g,D)=>D!==h);S("image",b)},children:e.jsx(B,{fontSize:"small"})}),e.jsx("img",{src:j.preview||URL.createObjectURL(j.image),alt:"preview",style:{width:"100%",maxHeight:"180px",objectFit:"contain"}})]},h))})]}),e.jsxs(_,{fullWidth:!0,children:[e.jsx(o,{sx:{mx:.5,mb:.4},children:"Video Upload"}),e.jsxs(I,{component:"label",role:void 0,variant:"outlined",tabIndex:-1,className:"upload-button",children:["Upload Video",e.jsx(N,{type:"file",name:"video",accept:"video/*",onBlur:p,onChange:j=>{const b=Array.from(j.currentTarget.files||[]).map(g=>Object.assign(g,{preview:URL.createObjectURL(g)}));S("video",[...r.video||[],...b])},multiple:!0})]}),w.video&&!!d.video&&e.jsx(R,{error:!0,children:d.video}),r.video&&r.video.length>0&&e.jsx(c,{mt:2,display:"flex",flexWrap:"wrap",gap:2,children:r.video.map((j,h)=>e.jsxs(c,{display:"flex",alignItems:"center",gap:1,sx:{position:"relative",border:"1px solid #ccc",borderRadius:"8px",padding:"8px 12px",backgroundColor:"#f9f9f9"},children:[e.jsx(A,{sx:{position:"absolute",top:"-11px",right:"-11px",padding:"4px",color:"#fff",bgcolor:"black","&:hover":{bgcolor:"black"}},onClick:()=>{const b=r.video.filter((g,D)=>D!==h);S("video",b)},children:e.jsx(B,{fontSize:"small"})}),e.jsx(Se,{fontSize:"large"}),e.jsx(o,{variant:"body2",noWrap:!0,maxWidth:500,children:j.name})]},h))})]}),e.jsxs(_,{fullWidth:!0,children:[e.jsx(o,{sx:{mx:.5,mb:.4},children:"PDF / Document Upload"}),e.jsxs(I,{component:"label",role:void 0,variant:"outlined",tabIndex:-1,className:"upload-button",children:["Upload Document",e.jsx(N,{type:"file",name:"image",accept:"application/pdf, application/msword, application/vnd.openxmlformats-officedocument.wordprocessingml.document",onBlur:p,onChange:j=>{const b=Array.from(j.currentTarget.files||[]).map(g=>Object.assign(g,{preview:URL.createObjectURL(g)}));S("document",[...r.document||[],...b])},multiple:!0})]}),w.document&&!!d.document&&e.jsx(R,{error:!0,children:d.document}),r.document&&r.document.length>0&&e.jsx(c,{mt:2,display:"flex",flexWrap:"wrap",gap:2,children:r.document.map((j,h)=>e.jsxs(c,{display:"flex",alignItems:"center",gap:1,sx:{position:"relative",border:"1px solid #ccc",borderRadius:"8px",padding:"8px 12px",backgroundColor:"#f9f9f9"},children:[e.jsx(A,{sx:{position:"absolute",top:"-11px",right:"-11px",padding:"4px",color:"#fff",bgcolor:"black","&:hover":{bgcolor:"black"}},onClick:()=>{const b=r.document.filter((g,D)=>D!==h);S("document",b)},children:e.jsx(B,{fontSize:"small"})}),e.jsx(Ie,{fontSize:"large"}),e.jsx(o,{variant:"body2",noWrap:!0,maxWidth:500,children:j.name})]},h))})]}),e.jsx(pe,{sx:{margin:"0px -24px"}}),e.jsxs(c,{sx:{display:"flex",justifyContent:"end",gap:"10px",width:"100%"},children:[e.jsx(I,{type:"submit",variant:"contained",color:"primary",loading:F,sx:{backgroundColor:"black",width:"100px",borderRadius:"10px",padding:"10px",fontWeight:"500",fontSize:"18px"},children:n?"Update":"Add"}),e.jsx(I,{variant:"contained",color:"",sx:{backgroundColor:"white",width:"100px",borderRadius:"10px",padding:"10px",fontWeight:"500",fontSize:"18px"},onClick:()=>m(),children:"Cancel"})]})]})})})]})}const Te={title:"",description:"",sections:[],category:"",status:"active",instructor_ids:"",participant_ids:[],course_image:null},De=48,Re=8,Q={PaperProps:{style:{maxHeight:De*4.5+Re,width:250}}},We=ie("input")({clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:1});function Pe(){const{id:T}=ue(),{user:m}=xe(),P=me(),{categoryData:E,refetchCategories:n,instructors:F,refetchInstructors:U,participants:L,refetchParticipants:$}=Ce(),{showToast:v}=he(),W=we(),[d,y]=k.useState(!1),[r,p]=k.useState(Te),[w,S]=k.useState([]),[j,h]=k.useState(!1),[b,g]=k.useState(null);console.log("Update Data",r);const D=async i=>{try{const{data:a,status:f,error:s}=await W(`/api/categories/finduserbycategory/${i}`,"GET");f===200?S(a.data):v(s,"error")}catch{v("Failed to fetch course.","error")}},se=async()=>{try{const{data:i,status:a,error:f}=await W(`/api/course/${T}`,"GET");if(a===200){const s=i.course;s.category=s.category_id?._id,s.instructor_ids=s.instructor_ids||"",s.participant_ids=s.participant_ids?.map(l=>l._id)||[],s.course_image=s.course_image,s.status=s.status===!0?"active":"inactive",p(s),m?.user_type===1&&s.instructor_ids&&D(s.instructor_ids)}else v(f,"error")}catch{v("Failed to fetch course.","error")}};k.useEffect(()=>{T?(m?.user_type===1?U():$(),se(),m?.user_type===2&&n()):(m?.user_type===1?U():$(),m?.user_type===2&&n())},[]);const V=m?.user_type===1?w:E,re=i=>{g(i),h(!0)},ae=()=>{h(!1),g(null)},ne=Z({title:z().required("Course Title required"),description:z().required("Description required"),instructor_ids:m?.user_type===1?z().required("Instructor required"):z(),participant_ids:m?.user_type===2?O().min(1,"At least one participant required"):O(),category:z().required("Category required"),course_image:ge().required("Course Image required")}),oe=async i=>{const a=new FormData;a.append("title",i.title),a.append("description",i.description),a.append("category_id",i.category),a.append("status",i.status==="active"),m?.user_type===1?a.append("instructor_ids",i.instructor_ids):a.append("participant_ids",JSON.stringify(i.participant_ids)),i.course_image instanceof File&&a.append("course_image",i.course_image),(i.sections||[]).forEach((s,l)=>{a.append(`sections[${l}].title`,s.title),a.append(`sections[${l}].lesson`,s.lesson),s.image?.forEach((x,t)=>{x instanceof File&&a.append(`sections[${l}].image`,x)}),s.video?.forEach((x,t)=>{x instanceof File&&a.append(`sections[${l}].video`,x)}),s.document?.forEach((x,t)=>{x instanceof File&&a.append(`sections[${l}].document`,x)})}),y(!0);try{if(T){const{data:s,status:l,error:x}=await W(`/api/course/update/${T}`,"PUT",a,!0);l===200?(v(s.message,"success"),P("/admin/course")):v(x,"error")}else{const{data:s,status:l,error:x}=await W("/api/course/create","POST",a,!0);l===200?(v(s.message,"success"),P("/admin/course")):v(x,"error")}}catch{v("Failed to update course.","error")}finally{y(!1)}};return e.jsxs(c,{style:{padding:"1.25rem",height:"100%",overflowY:"auto"},children:[e.jsxs("div",{children:[e.jsxs(o,{variant:"subtitle1",fontSize:"1.5rem",fontWeight:500,children:[T?"Update":"Create"," Course"]}),e.jsx(o,{variant:"subtitle2",fontWeight:500,children:"Details about the course"})]}),e.jsx(fe,{container:!0,spacing:2,justifyContent:"center",my:2,children:e.jsx(ee,{initialValues:r,enableReinitialize:!0,validationSchema:ne,onSubmit:oe,children:({errors:i,handleChange:a,values:f,handleBlur:s,touched:l,setFieldValue:x})=>e.jsxs(te,{style:{width:"100%",display:"flex",flexDirection:"column",gap:"1rem",marginTop:"0.5rem"},children:[e.jsxs(c,{sx:{display:"flex",gap:"2rem",width:"100%"},children:[e.jsxs(_,{fullWidth:!0,error:!!i.title,children:[e.jsx(o,{sx:{mx:.5,mb:.4},children:"Course Title"}),e.jsx(H,{id:"title",name:"title",type:"text",placeholder:"Course Title",value:f.title,onChange:a,onBlur:s,error:l.title&&!!i.title,helperText:l.title&&i.title})]}),e.jsxs(_,{fullWidth:!0,children:[e.jsx(o,{sx:{mx:.5,mb:.4},children:"Status"}),e.jsxs(je,{sx:{padding:"10px 0px",gap:"1rem"},children:[e.jsx(J,{checked:f.status==="active",onChange:a,value:"active",label:"Active",name:"status",size:"md"}),e.jsx(J,{checked:f.status==="inactive",onChange:a,value:"inactive",label:"Inactive",name:"status",size:"md"})]})]})]}),e.jsxs(c,{sx:{display:"flex",gap:"2rem",width:"100%"},children:[m?.user_type===1?e.jsxs(_,{fullWidth:!0,error:!!i.instructor_ids,children:[e.jsx(o,{sx:{mx:.5,mb:.4},children:"Instructors"}),e.jsxs(G,{displayEmpty:!0,id:"instructor_ids",name:"instructor_ids",MenuProps:Q,value:f.instructor_ids||[],onChange:t=>{a(t);const u=t.target.value;u&&(D(u),x("category",""))},onBlur:s,renderValue:t=>{if(!t||t.length===0)return e.jsx("span",{style:{color:"#aaa"},children:"Select Instructors"});const u=F.find(C=>C._id===t);return u?`${u.first_name} ${u.last_name}`:""},children:[e.jsx(q,{disabled:!0,value:"",children:e.jsx("em",{children:"Select Instructors"})}),F.map(t=>e.jsx(q,{value:t._id,children:e.jsx(Y,{primary:`${t.first_name} ${t.last_name}`})},t._id))]}),i.instructor_ids&&e.jsx(R,{children:i.instructor_ids})]}):e.jsxs(_,{fullWidth:!0,error:!!i.participant_ids,children:[e.jsx(o,{sx:{mx:.5,mb:.4},children:"Participants"}),e.jsxs(G,{multiple:!0,displayEmpty:!0,label:"",id:"participant_ids",name:"participant_ids",MenuProps:Q,value:f.participant_ids||[],onChange:a,onBlur:s,renderValue:t=>!t||t.length===0?e.jsx("span",{style:{color:"#aaa"},children:"Select Participants"}):t.map(u=>{const C=L.find(M=>M._id===u);return C?`${C.first_name} ${C.last_name}`:""}).join(", "),children:[e.jsx(q,{value:"",disabled:!0,children:e.jsx("em",{children:"Select Participants"})}),L.map(t=>e.jsxs(q,{value:t._id,children:[e.jsx(ye,{color:"black",checked:f.participant_ids?.includes(t._id)}),e.jsx(Y,{primary:`${t.first_name} ${t.last_name}`})]},t._id))]}),i.participant_ids&&e.jsx(R,{children:i.participant_ids})]}),e.jsxs(_,{fullWidth:!0,error:!!i.category,children:[e.jsx(o,{sx:{mx:.5,mb:.4},children:"Category"}),e.jsxs(G,{id:"category",name:"category",value:f.category,onChange:a,onBlur:s,displayEmpty:!0,renderValue:t=>{const u=V.find(C=>C._id===t);return u?u.name:e.jsx("span",{style:{color:"#aaa"},children:"Select Category"})},children:[e.jsx(q,{disabled:!0,value:"",children:e.jsx("em",{children:"Select Category"})}),V.length>0&&V.map(t=>e.jsx(q,{value:t._id,children:t.name},t._id))]}),l.category&&!!i.category&&e.jsx(R,{children:i.category})]})]}),e.jsxs(c,{sx:{display:"flex",gap:"2rem",width:"100%"},children:[e.jsxs(_,{fullWidth:!0,error:!!i.description,children:[e.jsx(o,{sx:{mx:.5,mb:.4},children:"Description"}),e.jsx(H,{id:"description",type:"text",multiline:!0,rows:4,placeholder:"Description",value:f.description,onChange:a,onBlur:s,error:l.description&&!!i.description,helperText:l.description&&i.description})]}),e.jsxs(_,{fullWidth:!0,children:[e.jsx(o,{sx:{mx:.5,mb:.4},children:"Course Image"}),e.jsxs(c,{component:"label",role:void 0,tabIndex:-1,sx:{border:"1px dashed #ccc",borderRadius:"8px",p:"6px"},children:[f.course_image?.preview?e.jsxs(c,{sx:{display:"flex",justifyContent:"center",position:"relative"},children:[e.jsx("img",{src:f.course_image.preview,alt:"Course Preview",style:{width:120,height:120,objectFit:"cover",borderRadius:8}}),e.jsx(A,{sx:{position:"absolute",top:0,right:0,padding:"4px",color:"#fff",bgcolor:"rgba(0,0,0,0.6)","&:hover":{bgcolor:"black"}},onClick:t=>{t.stopPropagation(),x("course_image",null)},children:e.jsx(B,{fontSize:"small"})})]}):e.jsxs(c,{sx:{py:4,cursor:"pointer"},children:[e.jsx(o,{textAlign:"center",fontWeight:700,children:"Drop file here or click to upload"}),e.jsx(o,{textAlign:"center",children:"JPG, PNG, PDF, or Video files. Max file size 3MB."})]}),e.jsx(We,{type:"file",id:"course_image",name:"course_image",accept:"image/*",onBlur:s,onChange:t=>{const u=t.currentTarget.files[0];if(u){const C=Object.assign(u,{preview:URL.createObjectURL(u)});x("course_image",C)}}})]}),l.course_image&&!!i.course_image&&e.jsx(R,{error:!0,children:i.course_image})]})]}),e.jsxs(c,{children:[r?.sections.length>0&&e.jsx(o,{sx:{mx:.5,mb:.4},children:"Sections"}),r?.sections.length>0&&r?.sections.map((t,u)=>e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",my:1,p:2,backgroundColor:"#f9f9f9",border:"1px solid #ccc",borderRadius:"8px"},children:[e.jsx(c,{children:e.jsx(o,{variant:"h6",children:t.title})}),e.jsxs(c,{sx:{display:"flex",gap:"10px"},children:[e.jsx(I,{variant:"outlined",color:"primary",onClick:()=>re(t),startIcon:e.jsx(be,{}),children:"Edit"}),e.jsx(I,{variant:"outlined",color:"error",startIcon:e.jsx(_e,{}),onClick:()=>{const C=r?.sections.filter(M=>M!==t);p({...r,sections:C})},children:"Delete"})]})]},u))]}),e.jsx(c,{children:e.jsx(I,{variant:"contained",color:"primary",sx:{bgcolor:"black",borderRadius:"10px",padding:"5px 10px",fontWeight:"500",fontSize:"18px"},startIcon:e.jsx(ve,{}),onClick:()=>{g(null),h(!0)},children:"Add Section"})}),e.jsxs(c,{sx:{display:"flex",justifyContent:"end",gap:"10px",width:"100%",my:2},children:[e.jsx(I,{loading:d,type:"submit",variant:"contained",color:"primary",sx:{backgroundColor:"black",width:"100px",borderRadius:"10px",padding:"10px",fontWeight:"500",fontSize:"18px"},children:T?"Update":"Save"}),e.jsx(I,{variant:"contained",color:"",sx:{backgroundColor:"white",width:"100px",borderRadius:"10px",padding:"10px",fontWeight:"500",fontSize:"18px"},onClick:()=>P("/admin/course"),children:"Cancel"})]})]})})}),e.jsx(ke,{open:j,courseRecord:r,setCourseRecord:p,handleClose:ae,selectedSection:b})]})}export{Pe as default};
