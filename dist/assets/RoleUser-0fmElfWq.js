import{c as z,j as t,u as W,f as G,a as L,r as a,w as B,W as H,e as F,B as l,T as I,l as V,m as q,S as Q,p as X,x as J,y as K,P as Y,Q as Z,I as d,R as ee,X as te,U as se}from"./index-CqBZos2q.js";const ae=z(t.jsx("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6h2c0-1.66 1.34-3 3-3s3 1.34 3 3v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m0 12H6V10h12zm-6-3c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2"}));function re(){const{user:w}=W(),{showToast:n}=G(),u=L(),c=F(),[p,i]=a.useState(!1),[b,S]=a.useState(null),[v,A]=a.useState(""),[E,j]=a.useState(""),[R,y]=a.useState(!1),[M,h]=a.useState([]),[T,C]=a.useState({}),[m,O]=a.useState(0),o=B(w,"role","edit"),g=async()=>{i(!0);try{const{data:e,status:s,error:r}=await c(`/api/user?limit=15&page=${m+1}`,"GET");s===200?(h(e.users),C(e.pagination)):(n(r,"error"),h([]))}catch{n("Failed to fetch users.","error")}finally{i(!1)}};a.useEffect(()=>{g()},[m]);const N=a.useMemo(()=>H.debounce(async e=>{i(!0);try{const{data:s,status:r,error:x}=await c(`/api/user?search=${e}`,"GET");r===200?(h(s.users),C(s.pagination)):n(x,"error")}catch(s){console.error("API Error:",s)}finally{i(!1)}},300),[]),D=e=>{const s=e.target.value;A(s),N(s)},f=()=>{y(!1),S(null),j("")},k=e=>{j(`${e.first_name||""} ${e.last_name||""}`),S(e._id),y(!0)},U=async(e,s)=>{try{const{data:r,status:x,error:$}=await c("/api/user/status","PATCH",{id:e,status:s});x===200?(n(r?.message,"success"),g()):n($,"error")}catch{n("Failed to change status.","error")}finally{i(!1),f()}},_=async()=>{i(!0);try{const{data:e,status:s,error:r}=await c("/api/user/delete","DELETE",{id:b});s===200?(n(e?.message,"success"),g()):n(r,"error")}catch{n("Failed to delete category.","error")}finally{i(!1),f()}},P=[{field:"username",headerName:"USER NAME",minWidth:150,flex:.5,headerAlign:"start",align:"start",valueGetter:(e,s)=>`${s.first_name||""} ${s.last_name||""}`},{field:"email",headerName:"EMAIL",minWidth:150,flex:.5,headerAlign:"start",align:"start"},{field:"mobile_no",headerName:"MOBILE NUMBER",minWidth:110,flex:.5,headerAlign:"start",align:"start"},{field:"status",headerName:"STATUS",minWidth:150,headerAlign:"start",align:"start",renderCell:e=>t.jsx(l,{children:t.jsx(Z,{color:"success",checked:e.row.status,disabled:!o,onClick:()=>U(e.row._id,!e.row.status)})})},{field:"Action",headerName:"ACTIONS",minWidth:150,flex:.5,headerAlign:"center",align:"center",renderCell:e=>t.jsxs(l,{direction:"row",spacing:1,children:[t.jsx(d,{onClick:()=>u(`/admin/role-user/edit-role/${e.row._id}`),disabled:!o,children:t.jsx(ee,{fontSize:"medium"})}),t.jsx(d,{onClick:()=>u(`/admin/role-user/permission/${e.row._id}`),disabled:!o,children:t.jsx(ae,{fontSize:"medium"})}),t.jsx(d,{children:t.jsx(te,{fontSize:"medium"})}),t.jsx(d,{onClick:()=>k(e.row),disabled:!o,children:t.jsx(se,{fontSize:"medium"})})]})}];return t.jsxs(l,{style:{padding:"1.25rem",height:"100%"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(I,{variant:"subtitle1",fontSize:"1.5rem",fontWeight:500,children:"Roles & Permissions"}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[t.jsx(V,{size:"small",placeholder:"Search user...",variant:"outlined",value:v,onChange:D,InputProps:{endAdornment:t.jsx(q,{position:"end",children:t.jsx(Q,{})})}}),o&&t.jsx(X,{sx:{bgcolor:"black",color:"white",fontWeight:"500"},variant:"outlined",startIcon:t.jsx(J,{}),onClick:()=>u("/admin/role-user/add-role"),children:"Add User"})]})]}),t.jsx(l,{sx:{marginTop:"10px",height:"100%"},children:t.jsx(K,{className:"custom-datagrid",rows:p?[]:M,columns:P,getRowId:e=>e._id,rowCount:T?.total_records,paginationMode:"server",paginationModel:{page:m,pageSize:15},onPaginationModelChange:e=>{O(e.page)},loading:p,disableRowSelectionOnClick:!0,disableColumnMenu:!0,rowHeight:50,slots:{noRowsOverlay:()=>t.jsx(l,{sx:{height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:1,p:2},children:t.jsx(I,{variant:"body1",color:"black",children:"Oops, No data found!"})})},sx:{height:"calc(100% - 5.3rem)",borderRadius:"10px","& .MuiDataGrid-cell:focus":{outline:"none"},"& .MuiDataGrid-cell:focus-within":{outline:"none"},"& .MuiDataGrid-columnHeader":{backgroundColor:"rgb(250, 250, 251)"}}})}),t.jsx(Y,{open:R,title:E,description:"This user will be deleted permanently.",onClose:f,onDelete:_})]})}export{re as default};
