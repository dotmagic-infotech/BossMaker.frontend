import{Y as k,u as C,a as N,f as I,r as x,g as L,h as u,j as e,T as r,F as U,i as $,A as E,s as V,Z as Y,B as m,k as l,l as c,_ as O,$ as _,D as w,a0 as Z,a1 as G,a2 as H,m as J,I as K,V as Q,n as X,p as v,e as ee,a3 as S}from"./index-CqBZos2q.js";const ae={first_name:"",last_name:"",email:"",mobile_no:"",dob:null,status:"active",role:"",password:""};function te(){const{id:p}=k(),{user:f}=C(),b=N(),{showToast:d}=I(),j=ee();console.log("user::",f);const[B,g]=x.useState(!1),[D,P]=x.useState(ae),[y,T]=x.useState(!1),[h,z]=x.useState(null),A=()=>T(a=>!a),F=async()=>{try{const{data:a,status:s,error:i}=await j(`/api/user/${p}`,"GET");if(s===200){const t=a.user;t.status=t.status===!0?"active":"inactive",t.dob=t.dob?S(t.dob):null,t.user_type===1?t.role="Admin":t.user_type===2?t.role="Member":t.user_type===3?t.role="Participant":t.role="Unknown",P(t)}else d(i,"error")}catch{d("Failed to fetch profile.","error")}};x.useEffect(()=>{p&&F()},[p]);const W=a=>{const s=a[0];s&&(s.preview=URL.createObjectURL(s),z(s))},R=L({first_name:u().required("First Name required"),last_name:u().required("Last Name required"),mobile_no:u().max(12).required("Mobile Number required"),email:u().email("Invalid email format").required("Email is required"),password:u().required("Password is required").min(6,"Password must be at least 6 characters").matches(/[A-Z]/,"Must contain at least one uppercase letter").matches(/[a-z]/,"Must contain at least one lowercase letter").matches(/[0-9]/,"Must contain at least one number").matches(/[@$!%*?&]/,"Must contain at least one special character")}),q=async a=>{const s=new FormData;s.append("first_name",a.first_name),s.append("last_name",a.last_name),s.append("status",a.status==="active"),s.append("email",a.email),s.append("mobile_no",a.mobile_no),s.append("password",a.password),s.append("user_type",f?.user_type===1?2:3),s.append("dob",a.dob?S(a.dob).format("YYYY-MM-DD"):""),h instanceof File&&s.append("profile_image",h),g(!0);try{if(p){const{data:i,status:t,error:o}=await j(`/api/user/update/${p}`,"PUT",s,!0);t===200?(d(i.message,"success"),b("/admin/role-user")):d(o,"error")}else{const{data:i,status:t,error:o}=await j("/api/user/create","POST",s,!0);t===200?(d(i.message,"success"),b("/admin/role-user")):d(o,"error")}}catch{d("Failed to update user.","error")}finally{g(!1)}};return e.jsxs("div",{style:{padding:"1.25rem",height:"100%",overflowY:"auto"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:e.jsx(r,{variant:"subtitle1",fontSize:"1.5rem",fontWeight:500,children:"Basic User Detail"})}),e.jsx(U,{initialValues:D,enableReinitialize:!0,validationSchema:R,onSubmit:q,children:({errors:a,handleChange:s,values:i,setFieldValue:t,handleBlur:o,touched:n})=>e.jsxs($,{style:{width:"100%",display:"flex",flexDirection:"column",gap:"10px"},children:[e.jsxs("div",{style:{marginTop:"10px",display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx(E,{src:h?.preview||i.profile_image,...V(`${i.first_name} ${i.last_name}`),sx:{width:90,height:90,fontSize:"3rem",bgcolor:"rgb(229, 229, 229)",color:"black",fontWeight:"500",borderRadius:"10px"}}),e.jsxs("div",{children:[e.jsx(r,{variant:"h5",fontSize:"19px",children:"Profile picture"}),e.jsxs(r,{variant:"caption",fontSize:"0.75rem",children:["Accepting file type .png .jpg .jpeg ",e.jsx("br",{})," Max size 3MB"]})]}),e.jsx(Y,{onDrop:W,name:"Upload",selectedFile:h,multiple:!1,accept:{"image/*":[]}})]}),e.jsxs(m,{sx:{display:"flex",gap:"3rem",width:"100%"},children:[e.jsxs(l,{fullWidth:!0,error:!!a.first_name,children:[e.jsx(r,{sx:{mx:.5,mb:.4},required:!0,children:"First Name"}),e.jsx(c,{id:"first_name",type:"text",placeholder:"First Name",value:i.first_name,onChange:s,onBlur:o,error:n.first_name&&!!a.first_name,helperText:n.first_name&&a.first_name})]}),e.jsxs(l,{fullWidth:!0,error:!!a.last_name,children:[e.jsx(r,{sx:{mx:.5,mb:.4},children:"Last Name"}),e.jsx(c,{id:"last_name",type:"text",placeholder:"Last Name",value:i.last_name,onChange:s,onBlur:o,error:n.last_name&&!!a.last_name,helperText:n.last_name&&a.last_name})]})]}),e.jsxs(m,{sx:{display:"flex",gap:"3rem",width:"100%"},children:[e.jsxs(l,{fullWidth:!0,error:!!a.mobile_no,children:[e.jsx(r,{sx:{mx:.5,mb:.4},children:"Mobile Number"}),e.jsx(c,{id:"mobile_no",type:"number",maxRows:12,placeholder:"Mobile Number",value:i.mobile_no,onChange:s,onBlur:o,error:n.mobile_no&&!!a.mobile_no,helperText:n.mobile_no&&a.mobile_no})]}),e.jsxs(l,{fullWidth:!0,error:!!a.email,children:[e.jsx(r,{sx:{mx:.5,mb:.4},children:"Email Address"}),e.jsx(c,{id:"email",type:"text",placeholder:"Email",value:i.email,onChange:s,onBlur:o,error:n.email&&!!a.email,helperText:n.email&&a.email})]})]}),e.jsx(m,{sx:{display:"flex",gap:"3rem",width:"100%"},children:e.jsxs(l,{fullWidth:!0,children:[e.jsx(r,{sx:{mx:.5,mb:.4},children:"Status"}),e.jsxs(O,{sx:{padding:"10px 0px",gap:"1rem"},children:[e.jsx(_,{checked:i.status==="active",onChange:s,value:"active",label:"Active",name:"status",size:"md"}),e.jsx(_,{checked:i.status==="inactive",onChange:s,value:"inactive",label:"Inactive",name:"status",size:"md"})]})]})}),e.jsx(w,{sx:{my:2,borderColor:"rgba(0, 0, 0, 0.12)"}}),e.jsx(r,{variant:"subtitle1",fontSize:"1.5rem",fontWeight:500,children:"Position Preference Detail"}),e.jsxs(m,{sx:{display:"flex",gap:"3rem",width:"100%"},children:[e.jsxs(l,{fullWidth:!0,error:!!a.dob,children:[e.jsx(r,{sx:{mx:.5,mb:.4},children:"Date of Birth"}),e.jsx(Z,{dateAdapter:G,children:e.jsx(H,{id:"dob",value:i.dob,onChange:M=>t("dob",M)})})]}),e.jsxs(l,{fullWidth:!0,children:[e.jsx(r,{sx:{mx:.5,mb:.4},children:"Role"}),e.jsx(c,{id:"role",type:"text",placeholder:"Role",value:f?.user_type===1?"Member":f?.user_type===2?"Participant":"",disabled:!0,onChange:s,onBlur:o,error:n.role&&!!a.role,helperText:n.role&&a.role})]})]}),e.jsx(w,{sx:{my:2,borderColor:"rgba(0, 0, 0, 0.12)"}}),e.jsx(r,{variant:"subtitle1",fontSize:"1.5rem",fontWeight:500,children:"Security Detail"}),e.jsxs(m,{sx:{display:"flex",gap:"3rem",width:"100%"},children:[e.jsxs(l,{fullWidth:!0,error:!!a.email,children:[e.jsx(r,{sx:{mx:.5,mb:.4},children:"Password"}),e.jsx(c,{id:"password",type:y?"text":"password",placeholder:"Password",value:i.password,onChange:s,onBlur:o,error:n.password&&!!a.password,helperText:n.password&&a.password,InputProps:{endAdornment:e.jsx(J,{position:"end",children:e.jsx(K,{onClick:A,edge:"end",children:y?e.jsx(Q,{}):e.jsx(X,{})})})}})]}),e.jsx(l,{fullWidth:!0})]}),e.jsxs(m,{sx:{display:"flex",justifyContent:"end",gap:"10px",width:"100%",mb:5},children:[e.jsx(v,{loading:B,type:"submit",variant:"contained",color:"primary",sx:{backgroundColor:"black",width:"100px",borderRadius:"10px",padding:"10px",fontWeight:"500",fontSize:"18px"},children:"Save"}),e.jsx(v,{variant:"contained",color:"",sx:{backgroundColor:"white",width:"100px",borderRadius:"10px",padding:"10px",fontWeight:"500",fontSize:"18px"},onClick:()=>b("/admin/role-user"),children:"Cancel"})]})]})})]})}export{te as default};
