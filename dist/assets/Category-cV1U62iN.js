import{t as $,v as Ae,f as Ne,u as Ge,r as y,w as Me,e as Pe,g as Fe,h as oe,j as r,B as G,T as L,l as ce,m as We,S as $e,p as z,x as Le,y as Be,z as Ue,E as ze,I as H,H as He,J as Ve,F as Je,i as Ke,k as le,K as Qe,b as de,q as Xe,D as Ye,P as Ze,Q as et,R as tt,U as rt}from"./index-MF_D1kqz.js";import{u as at}from"./CategoryContext-D9On0f3e.js";var V,ue;function Ie(){if(ue)return V;ue=1;function t(a){var i=typeof a;return a!=null&&(i=="object"||i=="function")}return V=t,V}var J,fe;function nt(){if(fe)return J;fe=1;var t=typeof $=="object"&&$&&$.Object===Object&&$;return J=t,J}var K,ge;function we(){if(ge)return K;ge=1;var t=nt(),a=typeof self=="object"&&self&&self.Object===Object&&self,i=t||a||Function("return this")();return K=i,K}var Q,me;function it(){if(me)return Q;me=1;var t=we(),a=function(){return t.Date.now()};return Q=a,Q}var X,he;function st(){if(he)return X;he=1;var t=/\s/;function a(i){for(var o=i.length;o--&&t.test(i.charAt(o)););return o}return X=a,X}var Y,be;function ot(){if(be)return Y;be=1;var t=st(),a=/^\s+/;function i(o){return o&&o.slice(0,t(o)+1).replace(a,"")}return Y=i,Y}var Z,pe;function Oe(){if(pe)return Z;pe=1;var t=we(),a=t.Symbol;return Z=a,Z}var ee,xe;function ct(){if(xe)return ee;xe=1;var t=Oe(),a=Object.prototype,i=a.hasOwnProperty,o=a.toString,u=t?t.toStringTag:void 0;function j(c){var b=i.call(c,u),p=c[u];try{c[u]=void 0;var n=!0}catch{}var g=o.call(c);return n&&(b?c[u]=p:delete c[u]),g}return ee=j,ee}var te,ye;function lt(){if(ye)return te;ye=1;var t=Object.prototype,a=t.toString;function i(o){return a.call(o)}return te=i,te}var re,je;function dt(){if(je)return re;je=1;var t=Oe(),a=ct(),i=lt(),o="[object Null]",u="[object Undefined]",j=t?t.toStringTag:void 0;function c(b){return b==null?b===void 0?u:o:j&&j in Object(b)?a(b):i(b)}return re=c,re}var ae,Te;function ut(){if(Te)return ae;Te=1;function t(a){return a!=null&&typeof a=="object"}return ae=t,ae}var ne,ve;function ft(){if(ve)return ne;ve=1;var t=dt(),a=ut(),i="[object Symbol]";function o(u){return typeof u=="symbol"||a(u)&&t(u)==i}return ne=o,ne}var ie,Se;function gt(){if(Se)return ie;Se=1;var t=ot(),a=Ie(),i=ft(),o=NaN,u=/^[-+]0x[0-9a-f]+$/i,j=/^0b[01]+$/i,c=/^0o[0-7]+$/i,b=parseInt;function p(n){if(typeof n=="number")return n;if(i(n))return o;if(a(n)){var g=typeof n.valueOf=="function"?n.valueOf():n;n=a(g)?g+"":g}if(typeof n!="string")return n===0?n:+n;n=t(n);var x=j.test(n);return x||c.test(n)?b(n.slice(2),x?2:8):u.test(n)?o:+n}return ie=p,ie}var se,_e;function mt(){if(_e)return se;_e=1;var t=Ie(),a=it(),i=gt(),o="Expected a function",u=Math.max,j=Math.min;function c(b,p,n){var g,x,I,C,m,v,S=0,M=!1,_=!1,A=!0;if(typeof b!="function")throw new TypeError(o);p=i(p)||0,t(n)&&(M=!!n.leading,_="maxWait"in n,I=_?u(i(n.maxWait)||0,p):I,A="trailing"in n?!!n.trailing:A);function w(l){var f=g,q=x;return g=x=void 0,S=l,C=b.apply(q,f),C}function B(l){return S=l,m=setTimeout(D,p),M?w(l):C}function P(l){var f=l-v,q=l-S,W=p-f;return _?j(W,I-q):W}function k(l){var f=l-v,q=l-S;return v===void 0||f>=p||f<0||_&&q>=I}function D(){var l=a();if(k(l))return O(l);m=setTimeout(D,P(l))}function O(l){return m=void 0,A&&g?w(l):(g=x=void 0,C)}function R(){m!==void 0&&clearTimeout(m),S=0,g=v=x=m=void 0}function F(){return m===void 0?C:O(a())}function N(){var l=a(),f=k(l);if(g=arguments,x=this,v=l,f){if(m===void 0)return B(v);if(_)return clearTimeout(m),m=setTimeout(D,p),w(v)}return m===void 0&&(m=setTimeout(D,p)),C}return N.cancel=R,N.flush=F,N}return se=c,se}var ht=mt();const bt=Ae(ht),pt=48,xt=8,yt={PaperProps:{style:{maxHeight:pt*4.5+xt,width:250}}},Ce={_id:"",name:"",id:""};function vt(){const{showToast:t}=Ne(),a=Pe(),{user:i}=Ge(),{instructors:o,refetchInstructors:u}=at(),[j,c]=y.useState(!1),[b,p]=y.useState(""),[n,g]=y.useState(!1),[x,I]=y.useState(Ce),[C,m]=y.useState(""),[v,S]=y.useState(null),[M,_]=y.useState(!1),[A,w]=y.useState([]),[B,P]=y.useState({}),[k,D]=y.useState(0),O=Me(i,"category","edit"),R=async()=>{c(!0);try{const{data:e,status:s,error:d}=await a(`/api/categories?limit=15&page=${k+1}`,"GET");s===200?(w(e.data),P(e.pagination)):(w([]),t(d,"error"))}catch{t("Failed to fetch categories.","error")}finally{c(!1)}},F=async e=>{try{const{data:s,status:d,error:T}=await a(`/api/categories/findbyid/${e}`,"GET");if(d===200){const h=s.data;h.id=h.assigned_to?._id,I(h),g(!0)}else t(T,"error")}catch{t("Failed to get Category.","error")}finally{S(null)}};y.useEffect(()=>{R(),u()},[k]),y.useEffect(()=>{x?._id&&i.user_type===1&&F()},[]);const N=y.useMemo(()=>bt(async e=>{c(!0);try{const{data:s,status:d,error:T}=await a(`/api/categories?search=${e}`,"GET");d===200?(w(s.data),P(s.pagination)):t(T,"error")}catch(s){console.error("API Error:",s)}finally{c(!1)}},300),[]),l=e=>{const s=e.target.value;p(s),N(s)},f=()=>{g(!1),_(!1),S(null),m(""),I(Ce)},q=e=>{m(e.name),S(e._id),_(!0)},W=Fe({name:oe().required("Category Name required"),id:oe().when([],{is:()=>i.user_type===1,then:e=>e.required("At least one user must be selected"),otherwise:e=>e.notRequired()})}),Re=async(e,s)=>{try{const{data:d,status:T,error:h}=await a("/api/categories/status","PATCH",{id:e,status:s});T===200?(t(d?.message,"success"),R()):t(h,"error")}catch{t("Failed to change status.","error")}finally{c(!1),f()}},qe=async()=>{c(!0);try{const{data:e,status:s,error:d}=await a("/api/categories/delete","DELETE",{id:v});s===200?(t(e?.message,"success"),_(!1),R()):t(d,"error")}catch{t("Failed to delete category.","error")}finally{c(!1),f()}},Ee=async e=>{c(!0);try{if(e?._id){const s={name:e.name};i.user_type===1&&(s.id=e.id);const{data:d,status:T,error:h}=await a(`/api/categories/update/${e?._id}`,"PUT",s);T===200?(t(d?.message,"success"),R(),f()):t(h,"error")}else{const s={name:e.name};i.user_type===1&&(s.id=e.id);const{data:d,status:T,error:h}=await a("/api/categories/create","POST",s);T===200?(t(d?.message,"success"),R(),f()):t(h,"error")}}catch{t("Something went wrong.","error")}finally{c(!1)}},ke=[{field:"name",headerName:"Category",flex:.5,headerAlign:"start",align:"start"},{field:"users",headerName:"USER NAME",minWidth:150,flex:.5,headerAlign:"start",align:"start",valueGetter:(e,s)=>`${s?.assigned_to?.first_name||""} ${s?.assigned_to?.last_name||""}`},{field:"status",headerName:"CATEGORY STATUS",headerAlign:"start",align:"start",flex:.5,renderCell:e=>r.jsx(et,{color:"success",checked:e.row.status,disabled:!O,onClick:()=>Re(e.row._id,!e.row.status)})},{field:"Action",headerName:"ACTIONS",flex:.5,headerAlign:"center",align:"center",renderCell:e=>r.jsxs(G,{direction:"row",spacing:1,children:[r.jsx(H,{onClick:()=>F(e.row._id),disabled:!O,children:r.jsx(tt,{fontSize:"medium"})}),r.jsx(H,{onClick:()=>q(e.row),disabled:!O,children:r.jsx(rt,{fontSize:"medium"})})]})}];return r.jsxs(G,{style:{padding:"1.25rem",height:"100%"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsx(L,{variant:"subtitle1",fontSize:"1.5rem",fontWeight:500,children:"Category"}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[r.jsx(ce,{size:"small",placeholder:"Search category...",variant:"outlined",value:b,onChange:l,InputProps:{endAdornment:r.jsx(We,{position:"end",children:r.jsx($e,{})})}}),O&&r.jsx(z,{sx:{bgcolor:"black",color:"white",fontWeight:"500"},variant:"outlined",startIcon:r.jsx(Le,{}),onClick:()=>g(!0),children:"Add Categoty"})]})]}),r.jsx(G,{sx:{marginTop:"10px",height:"100%"},children:r.jsx(Be,{className:"custom-datagrid",rows:j?[]:A,columns:ke,getRowId:e=>e._id,rowCount:B?.total_records,paginationMode:"server",paginationModel:{page:k,pageSize:15},onPaginationModelChange:e=>{D(e.page)},loading:j,disableRowSelectionOnClick:!0,disableColumnMenu:!0,rowHeight:50,slots:{noRowsOverlay:()=>r.jsx(G,{sx:{height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:1,p:2},children:r.jsx(L,{variant:"body1",color:"black",children:"Oops, No data found!"})})},sx:{height:"calc(100% - 5.3rem)",borderRadius:"10px","& .MuiDataGrid-cell:focus":{outline:"none"},"& .MuiDataGrid-cell:focus-within":{outline:"none"},"& .MuiDataGrid-columnHeader":{backgroundColor:"rgb(250, 250, 251)"}}})}),r.jsxs(Ue,{open:n,onClose:f,fullWidth:!0,sx:{borderRadius:"12px"},children:[r.jsxs(ze,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[x?.id?"Update":"Add"," Category",r.jsx(H,{color:"inherit",sx:{border:"1px solid black"},onClick:f,children:r.jsx(He,{})})]}),r.jsx(Ve,{dividers:!0,children:r.jsx(Je,{initialValues:x,enableReinitialize:!0,validationSchema:W,onSubmit:Ee,children:({errors:e,handleChange:s,values:d,handleBlur:T,touched:h})=>r.jsxs(Ke,{style:{width:"100%",display:"flex",flexDirection:"column",gap:"1rem"},children:[r.jsxs(le,{fullWidth:!0,children:[r.jsx(L,{sx:{mx:.5,mb:.4},children:"Category Name"}),r.jsx(ce,{fullWidth:!0,autoFocus:!0,id:"name",type:"text",placeholder:"Category Name",value:d.name,onChange:s,onBlur:T,error:!!(h.name&&e.name),helperText:h.name&&e.name?e.name:""})]}),i.user_type===1&&r.jsxs(le,{fullWidth:!0,children:[r.jsx(L,{sx:{mx:.5,mb:.4},children:"Select User"}),r.jsxs(Qe,{displayEmpty:!0,id:"id",name:"id",MenuProps:yt,value:d.id||"",onChange:s,onBlur:T,error:!!(h.id&&e.id),helperText:h.id&&e.id?e.id:"",renderValue:E=>{if(!E)return r.jsx("span",{style:{color:"#aaa"},children:"Select User"});const U=o.find(De=>De._id===E);return U?`${U.first_name} ${U.last_name}`:""},children:[r.jsx(de,{value:"",disabled:!0,children:"Select User"}),o.map(E=>r.jsxs(de,{value:E._id,children:[E.first_name," ",E.last_name]},E._id))]}),h.id&&!!e.id&&r.jsx(Xe,{error:!0,children:e.id})]}),r.jsx(Ye,{sx:{margin:"0px -24px"}}),r.jsxs(G,{sx:{display:"flex",justifyContent:"end",gap:"10px",width:"100%"},children:[r.jsx(z,{type:"submit",variant:"contained",color:"primary",loading:j,sx:{backgroundColor:"black",width:"100px",borderRadius:"10px",padding:"10px",fontWeight:"500",fontSize:"18px"},children:d?._id?"Update":"Save"}),r.jsx(z,{variant:"contained",color:"",sx:{backgroundColor:"white",width:"100px",borderRadius:"10px",padding:"10px",fontWeight:"500",fontSize:"18px"},onClick:()=>f(),children:"Cancel"})]})]})})})]}),r.jsx(Ze,{open:M,title:C,description:"This category will be deleted permanently.",onClose:f,onDelete:qe})]})}export{vt as default};
