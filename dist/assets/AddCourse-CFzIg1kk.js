import{c as ee,j as e,r as _,g as te,ai as E,h as F,z as fe,E as je,I as N,H as J,J as ye,F as ie,i as se,k as v,T as u,l as R,D as _e,B as m,p as I,a8 as re,q,Y as be,u as ve,a as we,f as Ce,aj as Se,G as Ie,_ as ke,$ as Q,K as M,b as z,ah as X,o as Te,R as De,U as Ae,x as Pe,e as $e}from"./index-MF_D1kqz.js";import{u as ze}from"./CategoryContext-D9On0f3e.js";const Fe=ee(e.jsx("path",{d:"M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m0 14H8V4h12zM4 6H2v14c0 1.1.9 2 2 2h14v-2H4zm12 6V9c0-.55-.45-1-1-1h-2v5h2c.55 0 1-.45 1-1m-2-3h1v3h-1zm4 2h1v-1h-1V9h1V8h-2v5h1zm-8 0h1c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1H9v5h1zm0-2h1v1h-1z"})),We=ee(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m-2.5-3.5 7-4.5-7-4.5z"})),qe=re("input")({clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:1}),G=({label:g,name:s,accept:P,icon:x,values:y,touched:$,errors:C,setFieldValue:k,setRemoveFile:S})=>e.jsxs(v,{fullWidth:!0,children:[e.jsx(u,{sx:{mx:.5,mb:.4},children:g}),e.jsxs(I,{component:"label",variant:"outlined",children:["Upload ",g,e.jsx(qe,{type:"file",accept:P,multiple:!0,onChange:o=>{const d=Array.from(o.currentTarget.files||[]).map(l=>Object.assign(l,{preview:URL.createObjectURL(l)}));k(s,[...y[s]||[],...d])}})]}),$[s]&&!!C[s]&&e.jsx(q,{error:!0,children:C[s]}),y[s]?.length>0&&e.jsx(m,{mt:2,display:"flex",flexWrap:"wrap",gap:2,children:y[s].map((o,f)=>e.jsxs(m,{display:"flex",alignItems:"center",gap:1,sx:{position:"relative",border:"1px solid #ccc",borderRadius:"8px",padding:"8px 12px",backgroundColor:"#f9f9f9",width:s==="image"?"146px":"auto",cursor:"pointer"},onClick:()=>{const d=o.preview||`https://bossmakeradmin.bossmakercpa.com/${o?.file_path}`;if(s==="video"){const l=window.open("");l&&l.document.write(`
                                        <video controls autoplay style="width:100%; height:100vh;">
                                        <source src="${d}" type="video/mp4">
                                        Your browser does not support the video tag.
                                        </video>
                                    `)}else s==="document"&&window.open(d,"_blank")},children:[e.jsx(N,{sx:{position:"absolute",top:"-11px",right:"-11px",padding:"4px",color:"#fff",bgcolor:"black","&:hover":{bgcolor:"black"}},onClick:()=>{const d=y[s].filter((l,j)=>j!==f);k(s,d),o._id&&S(l=>[...l,o._id])},children:e.jsx(J,{fontSize:"small"})}),s==="image"?e.jsx("img",{src:o.preview||`https://bossmakeradmin.bossmakercpa.com/${o?.file_path}`,alt:"preview",style:{width:"100%",maxHeight:"180px",objectFit:"contain"}}):e.jsxs(e.Fragment,{children:[x,e.jsx(u,{variant:"body2",noWrap:!0,maxWidth:500,children:o.name||o?.file_name})]})]},f))})]});function Ee({open:g,handleClose:s,setSectionFormData:P,selectedSection:x,setRemoveFile:y}){const[$,C]=_.useState(!1),[k,S]=_.useState({_id:"",title:"",lesson:"",image:[],video:[],document:[]});_.useEffect(()=>{S(x?{_id:x._id||"",title:x.title||"",lesson:x.lesson||"",image:x.image||[],video:x.video||[],document:x.document||[]}:{_id:"",title:"",lesson:"",image:[],video:[],document:[]})},[x]);const o=te({title:F().required("Section Title is required"),image:E().min(1,"At least one image is required").required(),video:E().min(1,"At least one video is required").required(),document:E().min(1,"At least one document is required").required()}),f=async d=>{C(!0),P(l=>{const j=Array.isArray(l)?l:[];return x?j.map(T=>T._id===x._id?{...T,...d}:T):[...j,{...d,_id:Date.now().toString()}]}),C(!1),s(),S({_id:"",title:"",lesson:"",image:[],video:[],document:[]})};return e.jsxs(fe,{fullWidth:!0,open:g,onClose:s,children:[e.jsxs(je,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[x?"Update":"Add"," Section",e.jsx(N,{onClick:s,sx:{border:"1px solid black"},children:e.jsx(J,{})})]}),e.jsx(ye,{dividers:!0,children:e.jsx(ie,{initialValues:k,enableReinitialize:!0,validationSchema:o,onSubmit:f,children:({errors:d,handleChange:l,values:j,handleBlur:T,touched:h,setFieldValue:D})=>e.jsxs(se,{style:{display:"flex",flexDirection:"column",gap:"1rem",marginTop:"0.5rem"},children:[e.jsxs(v,{fullWidth:!0,children:[e.jsx(u,{sx:{mx:.5,mb:.4},children:"Section Title"}),e.jsx(R,{name:"title",placeholder:"Section Title",value:j.title,onChange:l,onBlur:T,error:h.title&&!!d.title,helperText:h.title&&d.title})]}),e.jsxs(v,{fullWidth:!0,children:[e.jsx(u,{sx:{mx:.5,mb:.4},children:"Text Lesson"}),e.jsx(R,{name:"lesson",multiline:!0,rows:4,placeholder:"Text Lesson",value:j.lesson,onChange:l})]}),e.jsx(G,{label:"Image",name:"image",accept:"image/*",icon:null,values:j,touched:h,errors:d,setFieldValue:D,setRemoveFile:y}),e.jsx(G,{label:"Video",name:"video",accept:"video/*",icon:e.jsx(We,{fontSize:"large"}),values:j,touched:h,errors:d,setFieldValue:D,setRemoveFile:y}),e.jsx(G,{label:"Document",name:"document",accept:"application/pdf, application/msword, application/vnd.openxmlformats-officedocument.wordprocessingml.document",icon:e.jsx(Fe,{fontSize:"large"}),values:j,touched:h,errors:d,setFieldValue:D,setRemoveFile:y}),e.jsx(_e,{sx:{mx:-3}}),e.jsxs(m,{sx:{display:"flex",justifyContent:"end",gap:"10px"},children:[e.jsx(I,{loading:$,type:"submit",variant:"contained",sx:{bgcolor:"black",width:"100px",borderRadius:"10px",fontWeight:"500",fontSize:"18px"},children:x?"Update":"Add"}),e.jsx(I,{variant:"contained",sx:{bgcolor:"white",color:"black",width:"100px",borderRadius:"10px",fontWeight:"500",fontSize:"18px"},onClick:s,children:"Cancel"})]})]})})})]})}const Re=48,Be=8,Z={PaperProps:{style:{maxHeight:Re*4.5+Be,width:250}}},Oe=re("input")({clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:1});function Ve(){const{id:g}=be(),{user:s}=ve(),P=we(),{categoryData:x,refetchCategories:y,instructors:$,refetchInstructors:C,participants:k,refetchParticipants:S}=ze(),{showToast:o}=Ce(),f=$e(),[d,l]=_.useState(!1),[j,T]=_.useState({title:"",description:"",category:"",status:"active",instructor_ids:"",participant_ids:[],course_image:[],sections:[]}),[h,D]=_.useState([]),[ae,oe]=_.useState([]),[ne,B]=_.useState(!1),[O,U]=_.useState([]),[ce,H]=_.useState(null),Y=async i=>{try{const{data:p,status:n,error:a}=await f(`/api/categories/finduserbycategory/${i}`,"GET");n===200?oe(p.data):o(a,"error")}catch{o("Failed to fetch course.","error")}},le=async()=>{try{const{data:i,status:p,error:n}=await f(`/api/course/${g}`,"GET");if(p===200){const a=i.course;a.category=a.category_id?._id,a.instructor_ids=a.instructor_ids||"",a.participant_ids=a.participant_ids?.map(b=>b._id)||[],a.course_image=a.course_image,a.status=a.status===!0?"active":"inactive",D(a.sections||[]),T(a),s?.user_type===1&&a.instructor_ids&&Y(a.instructor_ids)}else o(n,"error")}catch{o("Failed to fetch course.","error")}};_.useEffect(()=>{g?(s?.user_type===1?C():S(),le(),s?.user_type===2&&y()):(s?.user_type===1?C():S(),s?.user_type===2&&y())},[]);const V=s?.user_type===1?ae:x,de=i=>{H(i),B(!0)},pe=()=>{B(!1),H(null)},ue=te({title:F().required("Course Title required"),description:F().required("Description required"),instructor_ids:s?.user_type===1?F().required("Instructor required"):F(),participant_ids:s?.user_type===2?E().min(1,"At least one participant required"):E(),category:F().required("Category required"),course_image:Se().required("Course Image required")}),xe=async i=>{l(!0);const p={title:i.title,description:i.description,category_id:i.category,status:i.status==="active",sections:h||[],...s?.user_type===1?{instructor_ids:i.instructor_ids}:{participant_ids:JSON.stringify(i.participant_ids)}};try{if(i.course_image instanceof File){const r=new FormData;r.append("file",i.course_image);const{data:c,status:w,error:A}=await f("/api/uploadFile","POST",r,!0);if(w===200)p.course_image=c.data;else{o(A||"Image upload failed","error"),l(!1);return}}else p.course_image=i.course_image;if(Array.isArray(h)&&h.length>0){const r=[];for(const c of h){const w={_id:c._id||null,title:c.title,lesson:c.lesson,image:[],video:[],document:[]};for(const A of["image","video","document"])if(Array.isArray(c[A]))for(const L of c[A])if(L instanceof File){const K=new FormData;K.append("file",L);const{data:me,status:he,error:ge}=await f("/api/uploadFile","POST",K,!0);if(he===200)w[A].push(me.data);else{o(ge||`${A} upload failed`,"error"),l(!1);return}}else w[A].push(L);r.push(w)}p.sections=r}if(Array.isArray(O)&&O.length>0){const{status:r,error:c}=await f("/api/uploadFile/delete","DELETE",{ids:O});r!==200&&o(c||"Failed to delete files.","error")}const n=g?`/api/course/update/${g}`:"/api/course/create",a=g?"PUT":"POST",{data:b,status:W,error:t}=await f(n,a,p);W===200?(o(b.message,"success"),U([]),P("/admin/course")):o(t||"Course submission failed","error")}catch{o("Failed to update course.","error")}finally{l(!1)}};return e.jsxs(m,{style:{padding:"1.25rem",height:"100%",overflowY:"auto"},children:[e.jsxs("div",{children:[e.jsxs(u,{variant:"subtitle1",fontSize:"1.5rem",fontWeight:500,children:[g?"Update":"Create"," Course"]}),e.jsx(u,{variant:"subtitle2",fontWeight:500,children:"Details about the course"})]}),e.jsx(Ie,{container:!0,spacing:2,justifyContent:"center",my:2,children:e.jsx(ie,{initialValues:j,enableReinitialize:!0,validationSchema:ue,onSubmit:xe,children:({errors:i,handleChange:p,values:n,handleBlur:a,touched:b,setFieldValue:W})=>e.jsxs(se,{style:{width:"100%",display:"flex",flexDirection:"column",gap:"1rem",marginTop:"0.5rem"},children:[e.jsxs(m,{sx:{display:"flex",gap:"2rem",width:"100%"},children:[e.jsxs(v,{fullWidth:!0,error:!!i.title,children:[e.jsx(u,{sx:{mx:.5,mb:.4},children:"Course Title"}),e.jsx(R,{id:"title",name:"title",type:"text",placeholder:"Course Title",value:n.title,onChange:p,onBlur:a,error:b.title&&!!i.title,helperText:b.title&&i.title})]}),e.jsxs(v,{fullWidth:!0,children:[e.jsx(u,{sx:{mx:.5,mb:.4},children:"Status"}),e.jsxs(ke,{sx:{padding:"10px 0px",gap:"1rem"},children:[e.jsx(Q,{checked:n.status==="active",onChange:p,value:"active",label:"Active",name:"status",size:"md"}),e.jsx(Q,{checked:n.status==="inactive",onChange:p,value:"inactive",label:"Inactive",name:"status",size:"md"})]})]})]}),e.jsxs(m,{sx:{display:"flex",gap:"2rem",width:"100%"},children:[s?.user_type===1?e.jsxs(v,{fullWidth:!0,error:!!i.instructor_ids,children:[e.jsx(u,{sx:{mx:.5,mb:.4},children:"Instructors"}),e.jsxs(M,{displayEmpty:!0,id:"instructor_ids",name:"instructor_ids",MenuProps:Z,value:n.instructor_ids||[],onChange:t=>{p(t);const r=t.target.value;r&&(Y(r),W("category",""))},onBlur:a,renderValue:t=>{if(!t||t.length===0)return e.jsx("span",{style:{color:"#aaa"},children:"Select Instructors"});const r=$.find(c=>c._id===t);return r?`${r.first_name} ${r.last_name}`:""},children:[e.jsx(z,{disabled:!0,value:"",children:e.jsx("em",{children:"Select Instructors"})}),$.map(t=>e.jsx(z,{value:t._id,children:e.jsx(X,{primary:`${t.first_name} ${t.last_name}`})},t._id))]}),i.instructor_ids&&e.jsx(q,{children:i.instructor_ids})]}):e.jsxs(v,{fullWidth:!0,error:!!i.participant_ids,children:[e.jsx(u,{sx:{mx:.5,mb:.4},children:"Participants"}),e.jsxs(M,{multiple:!0,displayEmpty:!0,label:"",id:"participant_ids",name:"participant_ids",MenuProps:Z,value:n.participant_ids||[],onChange:p,onBlur:a,renderValue:t=>!t||t.length===0?e.jsx("span",{style:{color:"#aaa"},children:"Select Participants"}):t.map(r=>{const c=k.find(w=>w._id===r);return c?`${c.first_name} ${c.last_name}`:""}).join(", "),children:[e.jsx(z,{value:"",disabled:!0,children:e.jsx("em",{children:"Select Participants"})}),k.map(t=>e.jsxs(z,{value:t._id,children:[e.jsx(Te,{color:"black",checked:n.participant_ids?.includes(t._id)}),e.jsx(X,{primary:`${t.first_name} ${t.last_name}`})]},t._id))]}),i.participant_ids&&e.jsx(q,{children:i.participant_ids})]}),e.jsxs(v,{fullWidth:!0,error:!!i.category,children:[e.jsx(u,{sx:{mx:.5,mb:.4},children:"Category"}),e.jsxs(M,{id:"category",name:"category",value:n.category,onChange:p,onBlur:a,displayEmpty:!0,renderValue:t=>{const r=V.find(c=>c._id===t);return r?r.name:e.jsx("span",{style:{color:"#aaa"},children:"Select Category"})},children:[e.jsx(z,{disabled:!0,value:"",children:e.jsx("em",{children:"Select Category"})}),V.length>0&&V.map(t=>e.jsx(z,{value:t._id,children:t.name},t._id))]}),b.category&&!!i.category&&e.jsx(q,{children:i.category})]})]}),e.jsxs(m,{sx:{display:"flex",gap:"2rem",width:"100%"},children:[e.jsxs(v,{fullWidth:!0,error:!!i.description,children:[e.jsx(u,{sx:{mx:.5,mb:.4},children:"Description"}),e.jsx(R,{id:"description",type:"text",multiline:!0,rows:4,placeholder:"Description",value:n.description,onChange:p,onBlur:a,error:b.description&&!!i.description,helperText:b.description&&i.description})]}),e.jsxs(v,{fullWidth:!0,children:[e.jsx(u,{sx:{mx:.5,mb:.4},children:"Course Image"}),e.jsxs(m,{component:"label",role:void 0,tabIndex:-1,sx:{border:"1px dashed #ccc",borderRadius:"8px",p:"6px"},children:[n.course_image?.preview||n.course_image?.file_path?e.jsxs(m,{sx:{display:"flex",justifyContent:"center",position:"relative"},children:[e.jsx("img",{src:n.course_image.preview||`https://bossmakeradmin.bossmakercpa.com/${n.course_image?.file_path}`,alt:"Course Preview",style:{width:120,height:120,objectFit:"cover",borderRadius:8}}),e.jsx(N,{sx:{position:"absolute",top:0,right:0,padding:"4px",color:"#fff",bgcolor:"rgba(0,0,0,0.6)","&:hover":{bgcolor:"black"}},onClick:async t=>{t.stopPropagation(),n.course_image?._id&&U(r=>[...r,n.course_image?._id]),W("course_image",null)},children:e.jsx(J,{fontSize:"small"})})]}):e.jsxs(m,{sx:{py:4,cursor:"pointer"},children:[e.jsx(u,{textAlign:"center",fontWeight:700,children:"Drop file here or click to upload"}),e.jsx(u,{textAlign:"center",children:"JPG, PNG, PDF, or Video files. Max file size 3MB."})]}),e.jsx(Oe,{type:"file",id:"course_image",name:"course_image",accept:"image/*",onBlur:a,onChange:t=>{const r=t.currentTarget.files[0];if(r){const c=Object.assign(r,{preview:URL.createObjectURL(r)});W("course_image",c)}}})]}),b.course_image&&!!i.course_image&&e.jsx(q,{error:!0,children:i.course_image})]})]}),e.jsxs(m,{children:[h?.length>0&&e.jsx(u,{sx:{mx:.5,mb:.4},children:"Sections"}),h?.length>0&&h.map((t,r)=>e.jsxs(m,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",my:1,p:2,backgroundColor:"#f9f9f9",border:"1px solid #ccc",borderRadius:"8px"},children:[e.jsx(m,{children:e.jsx(u,{variant:"h6",children:t.title})}),e.jsxs(m,{sx:{display:"flex",gap:"10px"},children:[e.jsx(I,{variant:"outlined",color:"primary",onClick:()=>de(t),startIcon:e.jsx(De,{}),children:"Edit"}),e.jsx(I,{variant:"outlined",color:"error",startIcon:e.jsx(Ae,{}),onClick:()=>{const c=h.filter(w=>w!==t);D(c)},children:"Delete"})]})]},r))]}),e.jsx(m,{children:e.jsx(I,{variant:"contained",color:"primary",sx:{bgcolor:"black",borderRadius:"10px",padding:"5px 10px",fontWeight:"500",fontSize:"18px"},startIcon:e.jsx(Pe,{}),onClick:()=>{H(null),B(!0)},children:"Add Section"})}),e.jsxs(m,{sx:{display:"flex",justifyContent:"end",gap:"10px",width:"100%",my:2},children:[e.jsx(I,{loading:d,type:"submit",variant:"contained",color:"primary",sx:{backgroundColor:"black",width:"100px",borderRadius:"10px",padding:"10px",fontWeight:"500",fontSize:"18px"},children:g?"Update":"Save"}),e.jsx(I,{variant:"contained",color:"",sx:{backgroundColor:"white",width:"100px",borderRadius:"10px",padding:"10px",fontWeight:"500",fontSize:"18px"},onClick:()=>P("/admin/course"),children:"Cancel"})]})]})})}),e.jsx(Ee,{open:ne,handleClose:pe,setSectionFormData:D,selectedSection:ce,setRemoveFile:U})]})}export{Ve as default};
